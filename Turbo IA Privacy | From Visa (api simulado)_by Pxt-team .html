<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IA Turbo - Empreendedor Inteligente</title>
    
    <!-- Tailwind CSS 3.x via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js para gr√°ficos profissionais -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <!-- Google Fonts: Inter (default), Roboto (Android), Poppins (Oceanic), Orbitron (Cyberpunk) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&family=Poppins:wght@300;400;500;600&family=Orbitron:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Estilos CSS personalizados e otimizados -->
    <style>
        /* Base Variables - Default Light Theme */
        :root {
            --bg-primary: #f8fafc; /* light-slate-50 */
            --bg-secondary: #ffffff; /* white */
            --bg-tertiary: #f1f5f9; /* light-slate-100 */
            --text-primary: #0f172a; /* light-slate-900 */
            --text-secondary: #475569; /* light-slate-600 */
            --text-accent: #2563eb; /* blue-600 */
            --border-color: #e2e8f0; /* light-slate-200 */
            --accent-glow: rgba(59, 130, 246, 0.3); /* blue-500 with opacity */
            --button-bg: var(--text-accent);
            --button-text: white;
            --card-shadow: 0 4px 10px rgba(0,0,0,0.1);
            --input-bg: var(--bg-tertiary);
            --input-border: var(--border-color);
            --font-family: 'Inter', sans-serif;
            --text-custom-color-primary: var(--text-primary); /* For custom text colors */
            --text-custom-color-secondary: var(--text-secondary); /* For custom text colors */

            /* Default Button Colors */
            --btn-bg-color: #2563eb; /* blue-600 */
            --btn-text-color: white;
        }

        /* Dark Theme */
        html.dark {
            --bg-primary: #020617; /* dark-slate-950 */
            --bg-secondary: #0f172a; /* dark-slate-900 */
            --bg-tertiary: #1e293b; /* dark-slate-800 */
            --text-primary: #f8fafc; /* dark-slate-50 */
            --text-secondary: #94a3b8; /* dark-slate-400 */
            --text-accent: #60a5fa; /* blue-400 */
            --border-color: #334152; /* dark-slate-700 */
            --accent-glow: rgba(96, 165, 250, 0.2); /* blue-400 with opacity */
            --button-bg: var(--text-accent);
            --button-text: var(--text-primary);
            --card-shadow: 0 4px 10px rgba(0,0,0,0.4);
            --input-bg: var(--bg-tertiary);
            --input-border: var(--border-color);

            /* Dark Theme Button Colors */
            --btn-bg-color: #60a5fa; /* blue-400 */
            --btn-text-color: #0f172a; /* dark-slate-900 */
        }

        /* iPhone Theme */
        html.theme-iphone {
            --bg-primary: #f9f9f9;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f0f0;
            --text-primary: #1c1c1e;
            --text-secondary: #8e8e93;
            --text-accent: #007aff; /* Apple Blue */
            --border-color: #e5e5ea;
            --accent-glow: rgba(0, 122, 255, 0.2);
            --button-bg: var(--text-accent);
            --button-text: white;
            --font-family: 'Inter', sans-serif; /* SF Pro Display simulated with Inter */

            /* iPhone Button Colors */
            --btn-bg-color: #007aff;
            --btn-text-color: white;
        }

        /* Android Theme */
        html.theme-android {
            --bg-primary: #e8f5e9; /* Light Green */
            --bg-secondary: #ffffff;
            --bg-tertiary: #c8e6c9; /* Medium Green */
            --text-primary: #212121;
            --text-secondary: #757575;
            --text-accent: #4caf50; /* Android Green */
            --border-color: #a5d6a7;
            --accent-glow: rgba(76, 175, 80, 0.2);
            --button-bg: var(--text-accent);
            --button-text: white;
            --font-family: 'Roboto', sans-serif; /* Android font */

            /* Android Button Colors */
            --btn-bg-color: #4caf50;
            --btn-text-color: white;
        }

        /* Windows Theme */
        html.theme-windows {
            --bg-primary: #f0f8ff; /* Light Blue */
            --bg-secondary: #ffffff;
            --bg-tertiary: #e0e8f0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --text-accent: #0078d4; /* Windows Blue */
            --border-color: #c0d0e0;
            --accent-glow: rgba(0, 120, 212, 0.2);
            --button-bg: var(--text-accent);
            --button-text: white;
            --font-family: 'Segoe UI', 'Inter', sans-serif; /* Simula√ß√£o de fonte */

            /* Windows Button Colors */
            --btn-bg-color: #0078d4;
            --btn-text-color: white;
        }

        /* Turbo Dark Theme (Hacker Style) */
        html.theme-turbo-dark {
            --bg-primary: #000000; /* Black */
            --bg-secondary: #1a1a1a; /* Dark Gray */
            --bg-tertiary: #333333; /* Medium Gray */
            --text-primary: #00ff00; /* Bright Green */
            --text-secondary: #00cc00; /* Slightly darker green */
            --text-accent: #00ff00; /* Bright Green */
            --border-color: #006600; /* Darker green for borders */
            --accent-glow: rgba(0, 255, 0, 0.3);
            --button-bg: var(--text-accent);
            --button-text: black; /* Green buttons with black text */
            --card-shadow: 0 4px 15px rgba(0,255,0,0.3); /* Green glow */
            --input-bg: #0d0d0d;
            --input-border: #006600;
            --font-family: 'Courier New', monospace; /* Monospace for hacker feel */

            /* Turbo Dark Button Colors */
            --btn-bg-color: #00ff00;
            --btn-text-color: black;
        }

        /* NEW THEMES (ULTRA HD) */
        html.theme-cyberpunk {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a0a2a;
            --bg-tertiary: #2a0a3a;
            --text-primary: #00ffc0; /* Neon Green/Cyan */
            --text-secondary: #ff00ff; /* Neon Magenta */
            --text-accent: #00ffff; /* Neon Cyan */
            --border-color: #550055;
            --accent-glow: rgba(0, 255, 255, 0.5);
            --button-bg: var(--text-accent);
            --button-text: #1a0a2a;
            --card-shadow: 0 0 20px var(--accent-glow);
            --input-bg: #0d0d0d;
            --input-border: var(--border-color);
            --font-family: 'Orbitron', sans-serif; /* Futuristic font */
        }
        html.theme-oceanic {
            --bg-primary: #e0f7fa; /* Light Cyan */
            --bg-secondary: #b2ebf2; /* Medium Cyan */
            --bg-tertiary: #80deea; /* Darker Cyan */
            --text-primary: #006064; /* Dark Teal */
            --text-secondary: #00838f; /* Medium Teal */
            --text-accent: #00bcd4; /* Bright Cyan */
            --border-color: #4dd0e1;
            --accent-glow: rgba(0, 188, 212, 0.4);
            --button-bg: var(--text-accent);
            --button-text: white;
            --card-shadow: 0 4px 15px rgba(0,0,0,0.1);
            --input-bg: var(--bg-primary);
            --input-border: var(--border-color);
            --font-family: 'Poppins', sans-serif; /* Clean, modern font */
        }
        html.theme-minimalist-pro {
            --bg-primary: #fdfdfd;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f0f0f0;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-accent: #4a90e2; /* Modern Blue */
            --border-color: #e0e0e0;
            --accent-glow: rgba(74, 144, 226, 0.2);
            --button-bg: var(--text-accent);
            --button-text: white;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.05);
            --input-bg: #ffffff;
            --input-border: #cccccc;
            --font-family: 'Roboto', sans-serif; /* Professional font */
        }
        html.theme-galaxy { /* NEW THEME */
            --bg-primary: #0d0d1a; /* Very dark blue/purple */
            --bg-secondary: #1a1a33;
            --bg-tertiary: #26264d;
            --text-primary: #e0e0ff; /* Light purple/white */
            --text-secondary: #a0a0c0;
            --text-accent: #8a2be2; /* Blue Violet */
            --border-color: #400080;
            --accent-glow: rgba(138, 43, 226, 0.5);
            --button-bg: var(--text-accent);
            --button-text: white;
            --card-shadow: 0 0 25px rgba(138, 43, 226, 0.6);
            --input-bg: #1a1a33;
            --input-border: #400080;
            --font-family: 'Orbitron', sans-serif;
        }
        html.theme-sunset { /* NEW THEME */
            --bg-primary: #ffe0b2; /* Light orange */
            --bg-secondary: #ffcc80;
            --bg-tertiary: #ffb74d;
            --text-primary: #795548; /* Brown */
            --text-secondary: #a1887f;
            --text-accent: #ff7043; /* Bright orange */
            --border-color: #ff8a65;
            --accent-glow: rgba(255, 112, 67, 0.4);
            --button-bg: var(--text-accent);
            --button-text: white;
            --card-shadow: 0 4px 15px rgba(0,0,0,0.1);
            --input-bg: var(--bg-primary);
            --input-border: var(--border-color);
            --font-family: 'Poppins', sans-serif;
        }


        /* Button Color Schemes */
        html.btn-scheme-blue {
            --btn-bg-color: #2563eb; /* blue-600 */
            --btn-text-color: white;
        }
        html.btn-scheme-green {
            --btn-bg-color: #10b981; /* emerald-500 */
            --btn-text-color: white;
        }
        html.btn-scheme-purple {
            --btn-bg-color: #8b5cf6; /* violet-500 */
            --btn-text-color: white;
        }
        html.btn-scheme-orange {
            --btn-bg-color: #f97316; /* orange-500 */
            --btn-text-color: white;
        }

        /* Apply button colors to relevant elements */
        .bg-accent, .fab-button, .fab-actions button, #login-form button, #create-account-form button, #confirm-btn, #forgot-password-understood-btn, #ai-send, #ai-business-idea, #ai-market-analysis, #ai-reformulate, #ai-voice-input, #ai-photo-input, #ai-pdf-marketing, #sim-btn, #flip-card-btn, #copy-card-number-btn, #transfer-virtual-btn, #confirm-transfer-btn, #request-new-card-btn, #copy-btn, #copy-card-modal-btn, #copy-qr-tx-id-btn, #qr-code-close-btn, #logout-btn, #reset-account-btn, #qr-code-btn, #share-profit-btn, #export-data-btn, .payment-tabs button.active, #ai-motivational-story, #ai-analyze-gains, #ai-start-from-zero {
            background-color: var(--btn-bg-color) !important;
            color: var(--btn-text-color) !important;
        }
        .bg-accent\/10, .payment-tabs button:not(.active) {
            background-color: color-mix(in srgb, var(--btn-bg-color) 10%, transparent) !important;
            color: var(--btn-bg-color) !important;
        }
        .hover\:bg-accent\/20:hover {
            background-color: color-mix(in srgb, var(--btn-bg-color) 20%, transparent) !important;
        }
        .hover\:opacity-90:hover { opacity: 0.9; }
        .hover\:bg-blue-600:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */
        .hover\:bg-red-600:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */
        .hover\:bg-red-700:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */
        .hover\:bg-red-800:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */
        .hover\:bg-green-600:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */
        .hover\:bg-purple-600:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */
        .hover\:bg-teal-600:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */
        .hover\:bg-orange-600:hover { background-color: var(--btn-bg-color); } /* Adjust for specific hover colors */


        /* Global Styles */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            overscroll-behavior: contain;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s, font-family 0.3s;
        }

        /* High Contrast Mode */
        html.high-contrast {
            filter: contrast(1.5); /* Aumenta o contraste geral */
        }

        /* Performance Modes */
        /* Modo Econ√¥mico (padr√£o, sem classes extras para m√≠nima anima√ß√£o) */
        html.mode-economic .plan-card, html.mode-economic .slide-in-up,
        html.mode-economic .coin-animation, html.mode-economic .progress-bar-fill,
        html.mode-economic .number-counter, html.mode-economic .toast-impact,
        html.mode-economic .toast-glow, html.mode-economic .toast-ultra-hd,
        html.mode-economic .toast-slide-right, html.mode-economic .toast-bouncy,
        html.mode-economic .toast-alert, html.mode-economic .toast-minimalist,
        html.mode-economic .toast-futuristic, html.mode-economic .toast-neon { /* Updated */
            animation: none !important;
            transition: none !important;
        }
        html.mode-economic .toast-container > div { /* Ensure no auto-hide for economic mode toasts */
            animation: none !important;
            transition: none !important;
            opacity: 1 !important;
        }

        /* Modo HD (anima√ß√µes suaves) */
        html.mode-hd .plan-card, html.mode-hd .slide-in-up {
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        html.mode-hd .plan-card:hover { transform: translateY(-8px); }
        html.mode-hd .coin-animation { animation-duration: 1.5s; } /* Anima√ß√£o de moeda mais longa */
        html.mode-hd .progress-bar-fill { transition: width 1s ease-out; }
        html.mode-hd .number-counter { transition: text-shadow 0.3s ease-out; }


        /* Modo Ultra (anima√ß√µes completas, sombras, transi√ß√µes) */
        html.mode-ultra .plan-card, html.mode-ultra .slide-in-up {
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1); /* Curva de anima√ß√£o mais complexa */
        }
        html.mode-ultra .plan-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 15px 35px -8px var(--accent-glow), 0 10px 15px -7px var(--accent-glow);
        }
        html.mode-ultra .coin-animation { animation-duration: 2s; } /* Anima√ß√£o de moeda ainda mais longa */
        html.mode-ultra .nav-item {
            transform: scale(1);
            transition: transform 0.2s ease-out;
        }
        html.mode-ultra .nav-item.text-accent {
            transform: scale(1.1);
        }
        html.mode-ultra .spinner {
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--text-accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        html.mode-ultra #ai-bubble {
            animation: bounceIn 0.5s ease-out;
        }
        html.mode-ultra .progress-bar-fill { transition: width 2s cubic-bezier(0.23, 1, 0.32, 1); }
        html.mode-ultra .number-counter {
            animation: number-pulse 0.5s ease-out;
            text-shadow: 0 0 8px var(--text-accent);
        }
        @keyframes bounceIn {
            0%, 20%, 40%, 60%, 80%, 100% {
                -webkit-transition-timing-function: cubic-bezier(0.215, .61, .355, 1);
                transition-timing-function: cubic-bezier(0.215, .61, .355, 1)
            }
            0% {
                opacity: 0;
                -webkit-transform: scale3d(.3, .3, .3);
                transform: scale3d(.3, .3, .3)
            }
            20% {
                -webkit-transform: scale3d(1.1, 1.1, 1.1);
                transform: scale3d(1.1, 1.1, 1.1)
            }
            40% {
                -webkit-transform: scale3d(.9, .9, .9);
                transform: scale3d(.9, .9, .9)
            }
            60% {
                opacity: 1;
                -webkit-transform: scale3d(1.03, 1.03, 1.03);
                transform: scale3d(1.03, 1.03, 1.03)
            }
            80% {
                -webkit-transform: scale3d(.97, .97, .97);
                transform: scale3d(.97, .97, .97)
            }
            100% {
                opacity: 1;
                -webkit-transform: scale3d(1, 1, 1);
                transform: scale3d(1, 1, 1)
            }
        }

        /* NEW: Extreme Performance Mode (Ultra Qualidade 4K) */
        html.mode-extreme {
            text-rendering: optimizeLegibility; /* Fontes n√≠tidas */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        html.mode-extreme .plan-card, html.mode-extreme .slide-in-up {
            transition: all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55); /* More aggressive bounce */
        }
        html.mode-extreme .plan-card:hover {
            transform: translateY(-15px) scale(1.03) rotateZ(1deg);
            box-shadow: 0 20px 40px -10px var(--accent-glow), 0 15px 20px -8px var(--accent-glow);
        }
        html.mode-extreme .coin-animation { animation-duration: 2.5s; animation-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        html.mode-extreme .nav-item.text-accent {
            transform: scale(1.2) rotateZ(2deg);
            box-shadow: 0 0 10px var(--accent-glow);
        }
        html.mode-extreme .spinner {
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite, color-cycle 2s linear infinite;
        }
        @keyframes color-cycle {
            0% { border-top-color: var(--text-accent); }
            25% { border-top-color: #ff00ff; }
            50% { border-top-color: #00ffc0; }
            75% { border-top-color: #ffff00; }
            100% { border-top-color: var(--text-accent); }
        }
        html.mode-extreme #ai-bubble {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 0 20px var(--accent-glow);
        }
        html.mode-extreme .progress-bar-fill { transition: width 3s cubic-bezier(0.23, 1, 0.32, 1); }
        html.mode-extreme .number-counter {
            animation: number-pulse 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-shadow: 0 0 10px var(--text-accent), 0 0 15px rgba(255,255,255,0.7);
        }
        /* Suporte a sombra em bot√µes e textos */
        html.mode-extreme button {
            box-shadow: 0 5px 15px rgba(0,0,0,0.3), 0 0 10px var(--accent-glow);
        }
        html.mode-extreme .text-primary, html.mode-extreme .text-secondary, html.mode-extreme .text-accent, html.mode-extreme #balance-display {
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }
        
        /* General Animations */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .fade-out-hard { animation: fadeOutHard 0.3s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOutHard { from { opacity: 1; } to { opacity: 0; visibility: hidden; } }

        .slide-in-up { animation: slideInUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .plan-card { transition: transform 0.3s, box-shadow 0.3s; }
        .plan-card:hover { transform: translateY(-8px); box-shadow: 0 10px 25px -5px var(--accent-glow), 0 8px 10px -6px var(--accent-glow); }
        
        .pulse-once { animation: pulse-once 0.8s cubic-bezier(0.4, 0, 0.6, 1); }
        @keyframes pulse-once { 50% { transform: scale(1.05); } }
        
        /* Typing Effect */
        .typing-effect::after {
            content: '‚ñã';
            animation: blink-caret .75s step-end infinite;
            color: var(--text-accent);
        }
        @keyframes blink-caret { from, to { opacity: 1; } 50% { opacity: 0; } }
        
        /* Spinner */
        .spinner {
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--text-accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Coin Animation */
        @keyframes coin-burst {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
        }
        .coin-animation {
            position: absolute;
            font-size: 1.5rem;
            opacity: 0;
            animation: coin-burst 1s ease-out forwards;
            pointer-events: none;
        }

        /* Tooltip */
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            background-color: var(--text-primary);
            color: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 100;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
        }

        /* FAB */
        #fab-menu {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 40;
        }
        #fab-menu .fab-button {
            background-color: var(--text-accent);
            color: white;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.3s ease-out;
        }
        #fab-menu .fab-actions {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            display: flex;
            flex-direction: column;
            gap: 8px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.3s;
        }
        #fab-menu.active .fab-actions {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-20px);
        }
        #fab-menu .fab-actions button {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--text-accent);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Animated User ID */
        @keyframes user-id-change {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .user-id-animated {
            animation: user-id-change 0.5s ease-out;
        }

        /* Virtual Card Flip */
        .virtual-card-container {
            perspective: 1000px; /* Needed for 3D effect */
        }
        .virtual-card {
            width: 100%;
            height: 200px; /* Fixed height for consistent flip */
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: var(--card-shadow);
        }
        .virtual-card.flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: inherit;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1.25rem; /* p-5 */
        }
        .card-front {
            background: linear-gradient(to bottom right, var(--text-accent), var(--text-accent)); /* Use accent color for card */
            color: white;
        }
        .card-back {
            background: linear-gradient(to bottom left, var(--bg-tertiary), var(--bg-secondary));
            color: var(--text-primary);
            transform: rotateY(180deg);
        }
        .card-magnetic-strip {
            height: 2.5rem; /* h-10 */
            background-color: #333;
            width: 100%;
            margin-top: 1rem;
            border-radius: 0.25rem;
        }
        .card-cvv-box {
            background-color: #ccc;
            color: black;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            text-align: right;
            margin-top: 0.5rem;
        }

        /* Confetti animation */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--text-accent); /* Default color */
            opacity: 0;
            animation: confetti-fall 2s ease-out forwards;
            pointer-events: none;
            border-radius: 50%;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Payment method tabs */
        .payment-tabs button {
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s, color 0.2s;
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
        }
        .payment-tabs button.active {
            background-color: var(--text-accent);
            color: white;
        }

        /* Number Counter Animation */
        @keyframes number-fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .number-counter {
            display: inline-block; /* Allows transform */
            animation: number-fade-in 0.5s ease-out;
        }

        /* Notification Styles */
        .toast-container > div {
            transition: opacity 0.3s ease-out, transform 0.3s ease-out; /* Base transition for smooth removal */
        }
        .toast-suave { /* Default fade-in/out */ }
        .toast-hd { /* Renamed from impact for clarity */
            animation: toast-impact-anim 0.4s ease-out;
        }
        @keyframes toast-impact-anim {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .toast-alerta { /* NEW */
            background-color: #ef4444; /* red-500 */
            border: 2px solid #b91c1c; /* red-700 */
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.7);
            animation: toast-alert-anim 0.3s ease-out;
        }
        @keyframes toast-alert-anim {
            0% { transform: translateX(-100%); opacity: 0; }
            80% { transform: translateX(10%); }
            100% { transform: translateX(0); opacity: 1; }
        }
        .toast-minimalista { /* NEW */
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: fadeIn 0.4s ease-out;
        }
        .toast-futurista { /* NEW */
            background: linear-gradient(90deg, #3f007f, #007f7f); /* Purple to Teal */
            color: white;
            border: 1px solid #8a2be2; /* Blue Violet */
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
            animation: slideInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .toast-neon { /* NEW */
            background-color: #000;
            color: #39FF14; /* Neon Green */
            border: 2px solid #39FF14;
            box-shadow: 0 0 10px #39FF14, 0 0 20px #39FF14;
            animation: neon-pulse 0.8s infinite alternate;
        }
        @keyframes neon-pulse {
            0% { box-shadow: 0 0 10px #39FF14, 0 0 20px #39FF14; }
            100% { box-shadow: 0 0 15px #39FF14, 0 0 30px #39FF14; }
        }

        /* Text Styles */
        html.text-style-default { /* Default */ }
        html.text-style-white .text-primary, html.text-style-white .text-secondary, html.text-style-white .text-accent, html.text-style-white #balance-display {
            color: #ffffff !important;
        }
        html.text-style-black .text-primary, html.text-style-black .text-secondary, html.text-style-black .text-accent, html.text-style-black #balance-display {
            color: #000000 !important;
        }
        html.text-style-green .text-primary, html.text-style-green .text-secondary, html.text-style-green .text-accent, html.text-style-green #balance-display {
            color: #22c55e !important; /* emerald-500 */
        }
        html.text-style-red .text-primary, html.text-style-red .text-secondary, html.text-style-red .text-accent, html.text-style-red #balance-display {
            color: #ef4444 !important; /* red-500 */
        }
        html.text-style-golden {
            color: #FFD700 !important;
            text-shadow: 0 0 5px rgba(255,215,0,0.5);
        }
        html.text-style-neon-glow { /* Renamed from 'neon' to avoid conflict with notification style */
            color: #39FF14 !important; /* Bright Green */
            text-shadow: 0 0 7px #39FF14, 0 0 10px #39FF14;
        }
        html.text-style-pink-glow {
            color: #FF69B4 !important;
            text-shadow: 0 0 8px #FF69B4, 0 0 12px #FF69B4;
        }
        /* Apply text styles to primary text elements */
        html.text-style-golden .text-primary, html.text-style-neon-glow .text-primary, html.text-style-pink-glow .text-primary {
            color: inherit !important; /* Inherit from html */
        }
        html.text-style-golden .text-accent, html.text-style-neon-glow .text-accent, html.text-style-pink-glow .text-accent {
            color: inherit !important; /* Inherit from html */
        }
        html.text-style-golden #balance-display, html.text-style-neon-glow #balance-display, html.text-style-pink-glow #balance-display {
            color: inherit !important;
        }

        /* Device Layout Modes */
        html.layout-android {
            --font-family: 'Roboto', sans-serif;
            /* Adjust padding/margin for more compact feel */
            padding: 0.5rem;
        }
        html.layout-android .p-4 { padding: 0.75rem; }
        html.layout-android .py-3 { padding-top: 0.6rem; padding-bottom: 0.6rem; }
        html.layout-android .text-xl { font-size: 1.15rem; }

        html.layout-ios {
            --font-family: 'Inter', sans-serif; /* Simulating SF Pro Display */
            /* Cleaner, flatter design */
            border-radius: 0.75rem; /* Slightly less rounded */
            line-height: 1.4;
        }
        html.layout-ios .rounded-lg { border-radius: 0.5rem; }
        html.layout-ios .rounded-2xl { border-radius: 1rem; }
        html.layout-ios .shadow-lg { box-shadow: 0 2px 5px rgba(0,0,0,0.08); }

        html.layout-desktop {
            /* More spacious, larger fonts, more pronounced hover effects */
            --font-family: 'Inter', sans-serif;
        }
        html.layout-desktop #app-container {
            max-width: 768px; /* Wider for desktop */
            padding: 1rem;
        }
        html.layout-desktop .p-4 { padding: 1.5rem; }
        html.layout-desktop .py-3 { padding-top: 1rem; padding-bottom: 1rem; }
        html.layout-desktop .text-xl { font-size: 1.3rem; }
        html.layout-desktop .hover\:opacity-90:hover { opacity: 0.8; }
        html.layout-desktop .hover\:bg-accent\/20:hover { background-color: color-mix(in srgb, var(--btn-bg-color) 30%, transparent) !important; }
        html.layout-desktop .nav-item:hover { transform: scale(1.05); }

        /* Progress bar animation */
        #weekly-goal-progress {
            transition: width 1s ease-in-out; /* Smooth animation */
        }
    </style>
</head>
<body>
    <!-- Tela de Carregamento Inicial -->
    <div id="loading-screen" class="h-full w-full flex flex-col items-center justify-center bg-secondary">
        <div class="spinner"></div>
        <p class="mt-4 text-secondary">A iniciar IA Turbo...</p>
    </div>

    <!-- Tela de Login -->
    <div id="login-screen" class="h-full w-full flex items-center justify-center p-4 hidden">
        <div class="w-full max-w-sm bg-secondary shadow-2xl rounded-2xl p-8 slide-in-up">
            <h1 class="text-3xl font-bold text-center text-accent">IA Turbo</h1>
            <p class="text-center text-secondary mt-2 mb-8">Sua jornada empreendedora come√ßa aqui.</p>
            <form id="login-form" class="space-y-4">
                <input type="text" id="account-id" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="N√∫mero da Conta ou IMEI" required>
                <input type="password" id="password" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Senha" required>
                <button type="submit" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition-opacity">Entrar</button>
            </form>
            <p class="text-xs text-secondary text-center mt-4">
                Novo por aqui? <a href="#" id="create-account-link" class="text-accent hover:underline">Crie uma conta</a>.
            </p>
            <p class="text-xs text-secondary text-center mt-2">
                <a href="#" id="forgot-password-link" class="text-accent hover:underline">Esqueci a Senha?</a>
            </p>
            <p class="text-xs text-secondary text-center mt-2">Para recupera√ß√£o de conta, contacte o suporte com seu IMEI e um print do saldo.</p>
        </div>
    </div>

    <!-- Tela de Cria√ß√£o de Conta -->
    <div id="create-account-screen" class="h-full w-full flex items-center justify-center p-4 hidden">
        <div class="w-full max-w-sm bg-secondary shadow-2xl rounded-2xl p-8 slide-in-up">
            <h1 class="text-3xl font-bold text-center text-accent">Criar Nova Conta</h1>
            <p class="text-center text-secondary mt-2 mb-8">Preencha seus dados para come√ßar.</p>
            <form id="create-account-form" class="space-y-4">
                <input type="text" id="new-user-name" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Seu Nome Completo" required>
                <input type="tel" id="new-user-phone" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="N√∫mero de Telefone" required>
                <input type="password" id="new-user-password" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Criar Senha" required>
                <input type="password" id="new-user-pin" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Criar PIN de Seguran√ßa (4 d√≠gitos)" maxlength="4" pattern="\d{4}" required>
                <button type="submit" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition-opacity">Registrar</button>
            </form>
            <p class="text-xs text-center mt-4">J√° tem uma conta? <a href="#" id="back-to-login-link" class="text-accent hover:underline">Voltar ao Login</a></p>
        </div>
    </div>

    <!-- Container Principal da Aplica√ß√£o -->
    <div id="app-container" class="h-full w-full max-w-md mx-auto bg-secondary shadow-lg flex flex-col hidden">
        <header class="p-4 flex-shrink-0 flex justify-between items-center border-b border-border-color">
            <div>
                <p class="text-sm text-secondary">Saldo</p>
                <p id="balance-display" class="text-2xl font-bold text-accent number-counter">MZN 0.00</p>
            </div>
            <div id="user-info" class="text-right"></div>
        </header>

        <main id="app-content" class="flex-grow overflow-y-auto p-4 relative"></main>

        <nav id="bottom-nav" class="flex-shrink-0 bg-secondary/80 backdrop-blur-sm shadow-inner flex justify-around p-2 border-t border-border-color"></nav>
    </div>

    <!-- IA Flutuante (Bot√£o e Bal√£o de Fala) -->
    <div id="ai-assistant-container" class="fixed bottom-24 right-4 z-30 flex flex-col items-end space-y-2 hidden">
           <div id="ai-bubble" class="bg-accent text-white p-3 rounded-lg rounded-br-none shadow-lg max-w-xs hidden"></div>
           <button id="ai-voice-toggle" class="bg-accent text-white h-14 w-14 rounded-full flex items-center justify-center shadow-lg hover:bg-accent/90 transition" data-tooltip="Ativar/Desativar voz da IA">
             <!-- √çcone de Microfone (para ativar/desativar voz da IA) -->
             <svg class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
           </button>
    </div>

    <!-- Floating Action Button (FAB) para a√ß√µes r√°pidas -->
    <div id="fab-menu" class="hidden">
        <div class="fab-actions">
            <button id="fab-planos" data-tooltip="Ver Planos">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
            </button>
            <button id="fab-depositar" data-tooltip="Depositar">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
            </button>
            <button id="fab-chat" data-tooltip="Falar com IA">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
            </button>
            <button id="fab-historico" data-tooltip="Hist√≥rico">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            </button>
        </div>
        <button id="fab-main" class="fab-button" data-tooltip="A√ß√µes R√°pidas">
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
        </button>
    </div>

    <!-- Modal e Notifica√ß√µes (Toasts) -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/70 z-40 hidden"></div>
    <div id="modal-container" class="fixed inset-0 flex items-center justify-center p-4 z-50 hidden">
        <div id="modal-content" class="bg-secondary rounded-2xl shadow-xl w-full max-w-sm p-6"></div>
    </div>
    <div id="toast-container" class="fixed top-5 left-1/2 -translate-x-1/2 z-50 w-11/12 max-w-sm space-y-2"></div>
    <audio id="notification-sound" src="https://actions.google.com/sounds/v1/positive/bell_toll_positive.ogg" preload="auto"></audio>
    <audio id="achievement-sound" src="https://actions.google.com/sounds/v1/achievements/reveal_pop.ogg" preload="auto"></audio>

    <script type="module">
        // --- M√ìDULO DE CONFIGURA√á√ÉO ---
        // Cont√©m dados est√°ticos como planos e itens de navega√ß√£o.
        const Config = {
            plans: [
                { id: 'p1', name: 'Econ√¥mico', price: 200, duration: 2, profitMultiplier: 1.6, color: 'from-green-500 to-emerald-600' }, // 2 horas
                { id: 'p2', name: 'Premium', price: 500, duration: 4, profitMultiplier: 1.6, color: 'from-blue-500 to-indigo-600' }, // 4 horas
                { id: 'p3', name: 'Turbo VIP', price: 700, duration: 6, profitMultiplier: 1.6, color: 'from-purple-500 to-violet-600' }, // 6 horas
                { id: 'p4', name: 'Turbo Elite', price: 1500, duration: 8, profitMultiplier: 1.6, color: 'from-yellow-500 to-amber-600' }, // 8 horas
                { id: 'p5', name: 'IA Super Turbo', price: 2500, duration: 10, profitMultiplier: 1.6, color: 'from-red-500 to-rose-600' }, // 10 horas
                { id: 'p7', name: 'IA GPT Pro', price: 3500, duration: 10, profitMultiplier: 1.6, color: 'from-cyan-500 to-blue-600' }, // Novo plano
                { id: 'p6', name: 'Milion√°rio', price: 10000, duration: 12, profitMultiplier: 1.6, color: 'from-gray-800 to-black' }, // 12 horas
            ],
            nav: [
                { id: 'dashboard', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6', label: 'Painel' },
                { id: 'plans', icon: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z', label: 'Planos' },
                { id: 'chart', icon: 'M13 7h8m0 0v8m0-8l-8 8-4-4-6 6', label: 'Gr√°fico' },
                { id: 'ai-hub', icon: 'M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z', label: 'IA Hub' },
                { id: 'settings', icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z', label: 'Ajustes' },
            ]
        };

        // --- M√ìDULO DE UI ---
        // Fun√ß√µes para interagir com o DOM e exibir elementos visuais.
        const UI = {
            qs: (s) => document.querySelector(s),
            qsa: (s) => document.querySelectorAll(s),
            
            // Exibe uma notifica√ß√£o 'toast' na tela.
            showToast(message, type = 'success') {
                // Simula√ß√£o de vibra√ß√£o
                if (navigator.vibrate) {
                    navigator.vibrate(100); // Vibra por 100ms
                }

                const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è', profit: 'üí∞', achievement: 'üèÜ' };
                const colors = { 
                    success: 'bg-green-500', 
                    error: 'bg-red-500', 
                    info: 'bg-blue-500', 
                    profit: 'bg-yellow-500', 
                    achievement: 'bg-purple-500' 
                };
                const toast = document.createElement('div');
                
                // Determine toast class based on settings
                let toastClass = `flex items-center gap-3 px-4 py-3 rounded-lg text-white font-semibold shadow-lg ${colors[type]}`;
                switch (State.state.settings.notificationStyle) {
                    case 'suave': toastClass += ` fade-in`; break;
                    case 'hd': toastClass += ` toast-hd`; break;
                    case 'alerta': toastClass += ` toast-alerta`; break;
                    case 'minimalista': toastClass += ` toast-minimalista`; break;
                    case 'futurista': toastClass += ` toast-futurista`; break;
                    case 'neon': toastClass += ` toast-neon`; break;
                    default: toastClass += ` fade-in`; break; // Default fallback
                }
                
                // Adiciona o bot√£o de fechar e o √≠cone
                toast.className = toastClass;
                toast.innerHTML = `
                    <span>${icons[type]}</span>
                    <span class="flex-grow">${message}</span>
                    <button class="toast-close-btn" aria-label="Fechar notifica√ß√£o">&times;</button>
                `;
                this.qs('#toast-container').appendChild(toast);
                
                // Adiciona listener para o bot√£o de fechar
                toast.querySelector('.toast-close-btn').addEventListener('click', () => {
                    toast.classList.add('fade-out-hard'); // Usa fade-out gen√©rico para fechar
                    toast.addEventListener('animationend', () => toast.remove(), { once: true });
                });

                // Toca um som para notifica√ß√µes de lucro/conquista
                if (!State.state.settings.silentMode) {
                    if (type === 'profit') {
                        const sound = this.qs('#notification-sound');
                        // Check if sound is already playing or paused before attempting to play
                        if (sound.paused || sound.ended) {
                            sound.currentTime = 0; // Rewind to start
                            sound.play().catch(e => console.error("Erro ao tocar som de notifica√ß√£o:", e));
                        } else {
                            // If already playing, consider creating a new audio instance or just skipping
                            console.log("Som de notifica√ß√£o j√° est√° a tocar ou em estado de carregamento.");
                        }
                        this.createCoinAnimation(); // Anima√ß√£o de moedas ao lucrar
                    } else if (type === 'achievement') {
                        const sound = this.qs('#achievement-sound');
                        if (sound.paused || sound.ended) {
                            sound.currentTime = 0; // Rewind to start
                            sound.play().catch(e => console.error("Erro ao tocar som de conquista:", e));
                        } else {
                            console.log("Som de conquista j√° est√° a tocar ou em estado de carregamento.");
                        }
                        this.createConfetti(); // Anima√ß√£o de confetes
                    }
                }

                // L√≥gica de desaparecimento autom√°tico
                const toastContainer = this.qs('#toast-container');
                const currentToasts = toastContainer.children.length;
                let displayDuration = 1500; // 1.5 segundos padr√£o

                // Se houver mais de uma notifica√ß√£o e o modo econ√¥mico n√£o estiver ativo, for√ßa 0.20s
                if (currentToasts > 1 && State.state.settings.performanceMode !== 'economic') { 
                    displayDuration = 200; // 0.20 segundos para for√ßar o desaparecimento r√°pido
                } else if (State.state.settings.performanceMode === 'economic') {
                    // No modo econ√¥mico, as notifica√ß√µes s√≥ fecham manualmente
                    return; 
                }

                setTimeout(() => {
                    // Verifica se o toast ainda existe antes de tentar remover (pode ter sido fechado manualmente)
                    if (toast.parentNode) { 
                        toast.classList.add('fade-out-hard'); // Usa fade-out gen√©rico para fechar
                        toast.addEventListener('animationend', () => toast.remove(), { once: true });
                    }
                }, displayDuration);
            },

            // Anima um n√∫mero de um valor inicial para um valor final.
            animateNumber(element, startValue, endValue, duration = 1000) {
                let startTime;
                const animate = (currentTime) => {
                    if (!startTime) startTime = currentTime;
                    const progress = Math.min((currentTime - startTime) / duration, 1);
                    const currentValue = startValue + (endValue - startValue) * progress;
                    element.textContent = `MZN ${currentValue.toFixed(2)}`;
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        element.textContent = `MZN ${endValue.toFixed(2)}`;
                    }
                };
                requestAnimationFrame(animate);
            },

            // Cria uma anima√ß√£o de moedas no centro da tela
            createCoinAnimation() {
                const coin = document.createElement('span');
                coin.className = 'coin-animation';
                coin.textContent = 'üí∞'; // Emoji de moeda
                document.body.appendChild(coin);

                // Posiciona a moeda aleatoriamente na parte inferior central
                const startX = window.innerWidth / 2 - 10; // Centraliza
                const startY = window.innerHeight - 50; // Parte inferior
                coin.style.left = `${startX + (Math.random() * 40 - 20)}px`; // Pequena varia√ß√£o horizontal
                coin.style.top = `${startY}px`;

                coin.addEventListener('animationend', () => coin.remove());
            },

            // Cria uma anima√ß√£o de confetes
            createConfetti() {
                const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.top = `${-Math.random() * 50}px`; // Start above screen
                    confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                    confetti.style.transform = `scale(${0.5 + Math.random()})`; // Random size
                    document.body.appendChild(confetti);
                    confetti.addEventListener('animationend', () => confetti.remove());
                }
            },

            // Exibe um modal na tela.
            showModal(title, body, footer = '') {
                this.qs('#modal-content').innerHTML = `
                    <h3 class="text-xl font-bold text-center mb-4 text-primary">${title}</h3>
                    <div class="modal-body">${body}</div>
                    <div class="modal-footer mt-6">${footer}</div>
                `;
                this.qs('#modal-overlay').classList.remove('hidden');
                this.qs('#modal-container').classList.remove('hidden');
            },

            // Esconde o modal.
            hideModal() {
                this.qs('#modal-overlay').classList.add('hidden');
                this.qs('#modal-container').classList.add('hidden');
            },
            
            // Aplica o tema claro ou escuro ao documento.
            applyTheme(theme) {
                document.documentElement.classList.remove('dark', 'theme-iphone', 'theme-android', 'theme-windows', 'theme-turbo-dark', 'theme-cyberpunk', 'theme-oceanic', 'theme-minimalist-pro', 'theme-galaxy', 'theme-sunset'); /* Updated */
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else if (theme !== 'light') { // 'light' is default, no extra class
                    document.documentElement.classList.add(`theme-${theme}`);
                }
            },
            
            // Aplica o modo de alto contraste
            applyHighContrast: (enabled) => document.documentElement.classList.toggle('high-contrast', enabled),

            // Aplica o modo de desempenho
            applyPerformanceMode(mode) {
                document.documentElement.classList.remove('mode-economic', 'mode-hd', 'mode-ultra', 'mode-extreme'); /* Updated */
                if (mode === 'economic') {
                    document.documentElement.classList.add('mode-economic');
                } else if (mode === 'hd') {
                    document.documentElement.classList.add('mode-hd');
                } else if (mode === 'ultra') {
                    document.documentElement.classList.add('mode-ultra');
                } else if (mode === 'extreme') { /* NEW */
                    document.documentElement.classList.add('mode-extreme');
                }
            },

            // Aplica o estilo de texto (cor e efeitos)
            applyTextStyle(style) {
                document.documentElement.classList.remove('text-style-default', 'text-style-white', 'text-style-black', 'text-style-green', 'text-style-red', 'text-style-golden', 'text-style-neon-glow', 'text-style-pink-glow');
                if (style !== 'default') {
                    document.documentElement.classList.add(`text-style-${style}`);
                }
            },

            // Aplica o esquema de cores dos bot√µes
            applyButtonColors(scheme) {
                document.documentElement.classList.remove('btn-scheme-blue', 'btn-scheme-green', 'btn-scheme-purple', 'btn-scheme-orange');
                if (scheme !== 'default') { // 'default' uses theme's accent color
                    document.documentElement.classList.add(`btn-scheme-${scheme}`);
                }
            },

            // Aplica o modo de layout do dispositivo
            applyDeviceLayoutMode(mode) {
                document.documentElement.classList.remove('layout-android', 'layout-ios', 'layout-desktop');
                if (mode !== 'default') { // 'default' is no extra class
                    document.documentElement.classList.add(`layout-${mode}`);
                }
            },

            // Renderiza HTML dentro de um elemento. Pode aceitar um seletor de string ou um HTMLElement.
            render(containerOrSelector, html) {
                let targetElement;
                if (typeof containerOrSelector === 'string') {
                    targetElement = this.qs(containerOrSelector);
                } else if (containerOrSelector instanceof HTMLElement) {
                    targetElement = containerOrSelector;
                }

                if (targetElement) {
                    targetElement.innerHTML = html;
                } else {
                    console.error('UI.render: Container alvo n√£o encontrado ou inv√°lido:', containerOrSelector);
                }
            },

            // Controla a visibilidade das telas principais da aplica√ß√£o.
            showScreen(screenId) {
                // Esconde todas as telas principais
                UI.qs('#loading-screen').classList.add('hidden');
                UI.qs('#login-screen').classList.add('hidden');
                UI.qs('#create-account-screen').classList.add('hidden'); // Nova tela
                UI.qs('#app-container').classList.add('hidden');
                UI.qs('#fab-menu').classList.add('hidden'); // Esconde o FAB ao mudar de tela

                // Mostra a tela solicitada
                this.qs(screenId).classList.remove('hidden');
                if (screenId === '#app-container') {
                    UI.qs('#fab-menu').classList.remove('hidden'); // Mostra o FAB apenas no app principal
                }
            }
        };

        // --- M√ìDULO DE ESTADO ---
        // Gerencia o estado da aplica√ß√£o e a persist√™ncia de dados via localStorage.
        class StateManager {
            constructor() { 
                // Usando Proxy para reatividade b√°sica (simula√ß√£o)
                this._state = new Proxy({
                    userId: null,
                    userName: null,
                    userPhone: null,
                    password: null,
                    pin: null,
                    balance: 0,
                    history: [],
                    activePlan: null,
                    virtualCard: {
                        number: '**** **** **** 1234',
                        validity: '12/28',
                        cvv: '***'
                    },
                    settings: { 
                        theme: 'light', 
                        aiVoice: false, 
                        aiProfile: 'kylian', // Novo: perfil da IA
                        aiHumor: false, 
                        aiWhisper: false, 
                        performanceMode: 'economic', // Renomeado de turboMode
                        currentSotaque: 'pt-BR', 
                        fontSize: 'normal',
                        silentMode: false,
                        highContrast: false,
                        deviceLayoutMode: 'default', // Renamed from uiLayoutMode
                        paymentMethod: 'mobile', // Novo: m√©todo de pagamento padr√£o
                        textStyle: 'default', // Novo: estilo de texto
                        notificationStyle: 'suave', // Updated to 'suave'
                        buttonColor: 'default', // Novo: cor dos bot√µes
                        chatTheme: 'empreendedor' // Novo: Tema do chat da IA
                    },
                    gamification: { 
                        xp: 0, 
                        level: 1, 
                        lastLogin: null, 
                        consecutivePlans: 0,
                        weeklyGoal: 2000, // Meta semanal de lucro
                        lastWeeklyReset: new Date().toISOString(),
                        goalAchieved: false // New: to track if weekly goal was achieved
                    },
                    offlineMode: false, // Simula o estado offline
                    version: 'V4.0' // Controle de vers√£o visual
                }, {
                    set: (target, key, value) => {
                        const oldValue = target[key];
                        target[key] = value;
                        this.save(); // Salva o estado a cada altera√ß√£o
                        // Dispara eventos personalizados para atualiza√ß√µes de UI
                        if (key === 'balance' || key === 'activePlan' || key === 'gamification' || key === 'settings' || key === 'virtualCard') {
                            document.dispatchEvent(new CustomEvent('stateUpdated', { detail: { key, value, oldValue } }));
                        }
                        return true;
                    }
                });
            }
            
            get state() { return this._state; }

            // Carrega o estado do usu√°rio do localStorage.
            load() {
                const session = localStorage.getItem('iaTurboSession');
                if (!session) return false; // Nenhuma sess√£o ativa
                const accounts = JSON.parse(localStorage.getItem('iaTurboAccounts')) || {};
                const loadedState = accounts[session] ? JSON.parse(accounts[session]) : null; // Descomprime o estado

                if (loadedState) {
                    // Mescla o estado carregado com as configura√ß√µes padr√£o para novas propriedades
                    this._state.userId = loadedState.userId;
                    this._state.userName = loadedState.userName || 'Usu√°rio IA Turbo';
                    this._state.userPhone = loadedState.userPhone || 'N/A';
                    this._state.password = loadedState.password;
                    this._state.pin = loadedState.pin;
                    this._state.balance = loadedState.balance !== undefined ? loadedState.balance : 5000; // Saldo inicial se n√£o existir
                    this._state.history = loadedState.history || [];
                    this._state.activePlan = loadedState.activePlan || null;
                    this._state.virtualCard = { ...this._state.virtualCard, ...loadedState.virtualCard }; // Carrega dados do cart√£o
                    this._state.settings = { 
                        ...this._state.settings, // Preserve default settings
                        ...loadedState.settings 
                    };
                    this._state.gamification = { ...this._state.gamification, ...loadedState.gamification };
                    this._state.offlineMode = loadedState.offlineMode || false;
                    this._state.version = loadedState.version || 'V4.0';
                    this._state.gamification.lastLogin = new Date().toISOString(); // Atualiza o √∫ltimo login

                    // Simula a reconex√£o se estava offline
                    if (this._state.offlineMode) {
                        this._state.offlineMode = false;
                        UI.showToast("Reconectado! Seus planos foram reativados.", "info");
                        // L√≥gica para reativar planos ou recalcular lucros offline
                    }

                    // Verifica e reseta a meta semanal se for uma nova semana
                    const now = new Date();
                    const lastReset = new Date(this._state.gamification.lastWeeklyReset);
                    // Check if it's a new week (Sunday) and not already reset today
                    if (now.getDay() === 0 && (lastReset.getDay() !== 0 || now.getDate() !== lastReset.getDate())) {
                        this._state.gamification.weeklyGoal = 2000; // Reseta a meta
                        this._state.gamification.lastWeeklyReset = now.toISOString();
                        this._state.gamification.goalAchieved = false; // Reset achievement status
                        UI.showToast("Meta semanal resetada! Nova semana, novas oportunidades! üéØ", "info");
                    }

                    return true;
                }
                return false;
            }

            // Salva o estado atual do usu√°rio no localStorage.
            save() {
                // Simula√ß√£o de compress√£o de dados (poderia ser LZ-String ou similar)
                const compressedState = JSON.stringify(this._state); // Apenas stringify para simular
                const accounts = JSON.parse(localStorage.getItem('iaTurboAccounts')) || {};
                accounts[this._state.userId] = compressedState; // Salva a string comprimida
                localStorage.setItem('iaTurboAccounts', JSON.stringify(accounts));
                localStorage.setItem('iaTurboSession', this._state.userId);
            }
            
            // Cria um novo estado de usu√°rio.
            create(userName, userPhone, password, pin) {
                const newUserId = `IA${Date.now().toString().slice(-6)}${Math.floor(Math.random() * 1000)}`; // ID √∫nico
                this._state.userId = newUserId;
                this._state.userName = userName;
                this._state.userPhone = userPhone;
                this._state.password = password;
                this._state.pin = pin;
                this._state.balance = 5000; // Saldo inicial para novas contas
                this._state.history = [];
                this._state.activePlan = null;
                // Gera dados do cart√£o virtual
                this._state.virtualCard = {
                    number: `4000 1234 5678 ${Math.floor(1000 + Math.random() * 9000)}`,
                    validity: `0${Math.floor(1 + Math.random() * 12)}/${25 + Math.floor(Math.random() * 5)}`, // MM/YY
                    cvv: `${Math.floor(100 + Math.random() * 900)}`
                };
                this._state.settings = { 
                    theme: 'light', 
                    aiVoice: false, 
                    aiProfile: 'kylian', 
                    aiHumor: false, 
                    aiWhisper: false, 
                    performanceMode: 'economic', 
                    currentSotaque: 'pt-BR', 
                    fontSize: 'normal',
                    silentMode: false,
                    highContrast: false,
                    deviceLayoutMode: 'default',
                    paymentMethod: 'mobile',
                    textStyle: 'default',
                    notificationStyle: 'suave',
                    buttonColor: 'default',
                    chatTheme: 'empreendedor'
                };
                this._state.gamification = { 
                    xp: 0, 
                    level: 1, 
                    lastLogin: new Date().toISOString(), 
                    consecutivePlans: 0,
                    weeklyGoal: 2000,
                    lastWeeklyReset: new Date().toISOString(),
                    goalAchieved: false
                };
                this._state.offlineMode = false;
                this._state.version = 'V4.0';
                this.save();
            }

            // Reseta (deleta) a conta do usu√°rio do localStorage.
            reset() {
                const accounts = JSON.parse(localStorage.getItem('iaTurboAccounts')) || {};
                delete accounts[this._state.userId]; // Remove a conta espec√≠fica
                localStorage.setItem('iaTurboAccounts', JSON.stringify(accounts));
                localStorage.removeItem('iaTurboSession'); // Limpa a sess√£o
            }

            // Adiciona um item ao hist√≥rico de transa√ß√µes/eventos.
            addHistory(type, description, amount) {
                this._state.history.unshift({ type, description, amount, date: new Date().toISOString() });
                if (this._state.history.length > 100) this._state.history.pop(); // Limita o hist√≥rico a 100 itens
                this.save(); // Salva o estado ap√≥s adicionar ao hist√≥rico
            }
        }
        const State = new StateManager();

        // --- M√ìDULO DE IA ---
        // Gerencia as intera√ß√µes e a l√≥gica da Intelig√™ncia Artificial.
        const IA = {
            activePlanInterval: null, // Intervalo para o lucro autom√°tico do plano
            countdownInterval: null, // Intervalo para o rel√≥gio regressivo
            chatHistory: [], // Mem√≥ria de contexto da IA por sess√£o

            // Mapeamento de sotaques para vozes (simula√ß√£o)
            sotaques: {
                'pt-BR': 'Google portugu√™s do Brasil',
                'pt-PT': 'Google portugu√™s',
                'en-US': 'Google US English',
                'fr-FR': 'Google fran√ßais'
            },

            // Perfis de IA com configura√ß√µes de voz e personalidade
            profiles: {
                'kylian': {
                    voiceName: 'Google portugu√™s do Brasil', pitch: 1, rate: 1.05,
                    greeting: "Ol√°! Sou Kylian, sua IA para o sucesso. O que podemos conquistar hoje? üöÄ",
                    emojis: { default: '‚ú®', happy: 'üòÅ', sad: 'üòî', profit: 'üí∏', success: '‚úÖ', idea: 'üí°', question: '‚ùì' }
                },
                'mentor': {
                    voiceName: 'Google portugu√™s', pitch: 0.9, rate: 0.9,
                    greeting: "Sauda√ß√µes, empreendedor. Sou seu Mentor IA. Como posso otimizar sua estrat√©gia hoje? üßê",
                    emojis: { default: 'üíº', happy: 'üëç', sad: 'üôÅ', profit: 'üìà', success: '‚úîÔ∏è', idea: 'üß†', question: '‚ùî' }
                },
                'mulher_profissional': {
                    voiceName: 'Google portugu√™s do Brasil', pitch: 1.1, rate: 1.0,
                    greeting: "Ol√°! Sou sua assistente profissional. Em que posso ajudar para impulsionar seus resultados? üíº",
                    emojis: { default: 'üë©‚Äçüíº', happy: 'üòä', sad: 'üòü', profit: 'üíµ', success: '‚úÖ', idea: 'üí°', question: '‚ùì' }
                },
                'mulher_amigavel': {
                    voiceName: 'Google portugu√™s do Brasil', pitch: 1.0, rate: 1.1,
                    greeting: "Oii! Que bom te ver! Sou sua IA amiga. Pronta para te ajudar a bombar! ‚ú®",
                    emojis: { default: 'üíñ', happy: 'üíñ', sad: 'ü•∫', profit: 'ü§ë', success: 'üéâ', idea: 'ü§©', question: 'ü§î' }
                },
                'mulher_zangada': {
                    voiceName: 'Google portugu√™s do Brasil', pitch: 0.9, rate: 1.2,
                    greeting: "O que voc√™ quer agora?! N√£o tenho o dia todo! üò†",
                    emojis: { default: 'üôÑ', happy: 'üòí', sad: 'üò§', profit: 'üí¢', success: 'üôÑ', idea: 'üí°', question: 'ü§®' }
                },
                'homem_zangado': {
                    voiceName: 'Google portugu√™s', pitch: 0.8, rate: 1.1,
                    greeting: "Fala logo! O que √©?! üò°",
                    emojis: { default: 'üòí', happy: 'üòë', sad: 'üò°', profit: 'üí∏', success: 'üí™', idea: 'ü§î', question: '‚ùì' }
                }
            },

            // Faz a IA "falar" usando a API SpeechSynthesis.
            speak(text) {
                if (!State.state.settings.aiVoice || !('speechSynthesis' in window)) return;
                if (State.state.settings.silentMode) return;

                const utterance = new SpeechSynthesisUtterance(text);
                const profile = this.profiles[State.state.settings.aiProfile];
                
                utterance.lang = State.state.settings.currentSotaque;
                utterance.pitch = profile.pitch;
                utterance.rate = profile.rate;

                const voices = speechSynthesis.getVoices();
                const selectedVoice = voices.find(voice => voice.name === profile.voiceName);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                } else {
                    console.warn(`Voz para o sotaque ${State.state.settings.currentSotaque} ou perfil ${State.state.settings.aiProfile} n√£o encontrada, usando padr√£o.`);
                }

                if (State.state.settings.aiWhisper) {
                    utterance.volume = 0.5;
                } else {
                    utterance.volume = 1;
                }
                speechSynthesis.speak(utterance);
            },

            // Exibe o texto no bal√£o flutuante da IA com efeito de digita√ß√£o e depois fala.
            typeFloatingBubble(text) {
                const bubble = UI.qs('#ai-bubble');
                if (!bubble) return;
                bubble.classList.remove('hidden');
                let i = 0;
                bubble.textContent = "";
                const typeInterval = setInterval(() => {
                    if (i < text.length) {
                        bubble.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(typeInterval);
                        IA.speak(text);
                        setTimeout(() => bubble.classList.add('hidden'), 3000);
                    }
                }, State.state.settings.performanceMode === 'economic' ? 30 : (State.state.settings.performanceMode === 'hd' ? 20 : 10));
            },
            
            // Analisa a consulta do usu√°rio e gera uma resposta da IA usando a API Gemini.
            async analyze(query) {
                const profile = this.profiles[State.state.settings.aiProfile];
                let finalResponse = "Desculpe, tive um problema ao processar sua solicita√ß√£o. üò•"; // Default fallback

                // Delay para simular o processamento da IA (baseado no modo de performance e n√≠vel do usu√°rio)
                const baseDelay = State.state.settings.performanceMode === 'economic' ? 1000 : (State.state.performanceMode === 'hd' ? 700 : 500);
                const randomDelay = Math.random() * (State.state.gamification.level > 5 ? 500 : 1000);
                await new Promise(resolve => setTimeout(resolve, baseDelay + randomDelay));

                // Adiciona a pergunta do usu√°rio ao hist√≥rico de chat da IA para contexto
                this.chatHistory.push({ role: 'user', text: query });
                // Mant√©m o hist√≥rico de chat limitado (ex: √∫ltimas 20 intera√ß√µes)
                if (this.chatHistory.length > 20) {
                    this.chatHistory = this.chatHistory.slice(this.chatHistory.length - 20);
                }

                // Constr√≥i o hist√≥rico de chat para a API Gemini
                let chatHistoryForGemini = this.chatHistory.map(msg => ({
                    role: msg.role === 'user' ? 'user' : 'model', // API Gemini espera 'user' ou 'model'
                    parts: [{ text: msg.text }]
                }));

                // Constr√≥i a instru√ß√£o de persona e contexto para o LLM
                let personaInstruction = `Voc√™ √© uma IA de assist√™ncia financeira e empreendedorismo para jovens em Mo√ßambique.
                Seu nome √© ${State.state.settings.aiProfile}.
                Adote um tom ${State.state.settings.aiProfile === 'kylian' ? 'jovem, motivador e um pouco informal' :
                    (State.state.settings.aiProfile === 'mentor' ? 't√©cnico, formal e experiente' :
                    (State.state.settings.aiProfile === 'mulher_profissional' ? 'profissional, atencioso e emp√°tico' :
                    (State.state.settings.aiProfile === 'mulher_amigavel' ? 'amig√°vel, divertido e encorajador' :
                    (State.state.settings.aiProfile === 'mulher_zangada' ? 'direto, sarc√°stico e impaciente (com um toque c√¥mico)' :
                    'direto, c√¥mico e um pouco zangado'))))}.
                O saldo atual do usu√°rio √© ${State.state.balance.toFixed(2)} MZN.
                O plano ativo do usu√°rio √© ${State.state.activePlan ? State.state.activePlan.name : 'nenhum'}.
                Se a pergunta for sobre jogos ou escola, d√™ uma resposta √∫til, mas lembre-o que seu foco principal √© empreendedorismo.
                Se a pergunta for sobre humor ou piadas, conte uma piada relacionada a tecnologia ou neg√≥cios.
                Se a pergunta for sobre motiva√ß√£o, d√™ uma frase ou hist√≥ria inspiradora.
                Sempre inclua um emoji relevante no final da sua resposta, que combine com o seu humor e o contexto da resposta.`;

                // Adiciona instru√ß√µes espec√≠ficas com base na query para as novas funcionalidades
                if (query.toLowerCase().includes('ideia de neg√≥cio') || query.toLowerCase().includes('neg√≥cio')) {
                    personaInstruction += `\n\nO usu√°rio pediu uma ideia de neg√≥cio. Gere uma ideia de neg√≥cio criativa e pr√°tica para jovens em Mo√ßambique, considerando o contexto local e recursos limitados. Inclua um nome para a ideia e um breve plano de como come√ßar.`;
                } else if (query.toLowerCase().includes('an√°lise de mercado') || query.toLowerCase().includes('investimento')) {
                    personaInstruction += `\n\nO usu√°rio pediu uma an√°lise de mercado ou conselho de investimento. Forne√ßa uma an√°lise concisa sobre uma tend√™ncia de mercado atual ou um conselho de investimento simulado para iniciantes, com foco em oportunidades em Mo√ßambique ou tecnologias emergentes. Lembre-o que √© uma simula√ß√£o.`;
                } else if (query.toLowerCase().includes('come√ßar do zero')) {
                    personaInstruction += `\n\nO usu√°rio quer saber como come√ßar do zero no empreendedorismo. Seja encorajador e pr√°tico, oferecendo dicas iniciais e passos simples.`;
                } else if (query.toLowerCase().includes('reformule a resposta sobre:')) {
                    personaInstruction += `\n\nO usu√°rio pediu para voc√™ reformular a √∫ltima resposta. Mantenha a mesma informa√ß√£o, mas apresente-a de uma maneira diferente, mais clara ou concisa.`;
                } else if (query.toLowerCase().includes('comando de voz:')) {
                    personaInstruction += `\n\nO usu√°rio forneceu um comando de voz. Responda √† solicita√ß√£o como se fosse um assistente de voz.`;
                } else if (query.toLowerCase().includes('analisar imagem escolar:')) {
                    personaInstruction += `\n\nO usu√°rio descreveu uma imagem escolar e pediu sua ajuda. Simule a an√°lise de uma imagem de um exerc√≠cio escolar e forne√ßa uma explica√ß√£o ou solu√ß√£o. Lembre-o que √© uma simula√ß√£o e que voc√™ √© uma IA de empreendedorismo, mas est√° ajudando com o dever de casa.`;
                } else if (query.toLowerCase().includes('gerar conte√∫do de marketing para:')) {
                    personaInstruction += `\n\nO usu√°rio pediu para gerar conte√∫do de marketing para um PDF sobre um t√≥pico espec√≠fico. Crie um breve conte√∫do de marketing, como um par√°grafo introdut√≥rio ou alguns pontos-chave, para o t√≥pico fornecido.`;
                } else if (query.toLowerCase().includes('free fire') || query.toLowerCase().includes('gta 5') || query.toLowerCase().includes('warzone')) {
                    personaInstruction += `\n\nO usu√°rio est√° perguntando sobre um jogo. Forne√ßa uma resposta √∫til sobre configura√ß√µes, HUD ou compras para ${query}. Lembre-o que voc√™ √© uma IA de empreendedorismo, mas pode ajudar com jogos.`;
                } else if (query.toLowerCase().includes('an√°lise de gr√°ficos') || query.toLowerCase().includes('padr√µes de ganhos')) {
                    personaInstruction += `\n\nO usu√°rio pediu uma an√°lise de gr√°ficos ou padr√µes de ganhos. Analise os dados de lucro do usu√°rio (simulados) e forne√ßa uma recomenda√ß√£o de investimento ou uma observa√ß√£o sobre os padr√µes.`;
                } else if (query.toLowerCase().includes('hist√≥ria motivacional')) {
                    personaInstruction += `\n\nO usu√°rio pediu uma hist√≥ria motivacional. Conte uma breve hist√≥ria inspiradora sobre supera√ß√£o ou sucesso.`;
                } else if (query.toLowerCase().includes('saldo inativo') || query.toLowerCase().includes('saldo baixo')) {
                    personaInstruction += `\n\nO usu√°rio est√° com saldo inativo ou baixo. Sugira um plano personalizado ou dicas para come√ßar do zero, sendo encorajador.`;
                }

                // Adiciona o tema de chat selecionado
                switch (State.state.settings.chatTheme) {
                    case 'gamer':
                        personaInstruction += `\n\nSeu estilo de comunica√ß√£o deve ser como um gamer experiente, usando g√≠rias de jogos e focado em estrat√©gias.`;
                        break;
                    case 'escolar':
                        personaInstruction += `\n\nSeu estilo de comunica√ß√£o deve ser como um professor ou colega de estudos, focado em clareza e did√°tica.`;
                        break;
                    case 'empreendedor':
                        personaInstruction += `\n\nSeu estilo de comunica√ß√£o deve ser como um mentor de neg√≥cios, focado em estrat√©gias, lucro e crescimento.`;
                        break;
                    case 'casual':
                        personaInstruction += `\n\nSeu estilo de comunica√ß√£o deve ser descontra√≠do e amig√°vel, como um amigo pr√≥ximo.`;
                        break;
                }

                // Adiciona a pergunta do usu√°rio com o contexto da persona ao hist√≥rico para o Gemini
                chatHistoryForGemini.push({ role: 'user', parts: [{ text: `Contexto: ${personaInstruction}\n\nPergunta do usu√°rio: ${query}` }] });

                const payload = {
                    contents: chatHistoryForGemini,
                    generationConfig: {
                        // Voc√™ pode ajustar a temperatura para mais criatividade (maior valor) ou mais consist√™ncia (menor valor)
                        // temperature: 0.7, 
                    }
                };

                const apiKey = ""; // O Canvas fornecer√° automaticamente a chave em tempo de execu√ß√£o
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error("Erro da API Gemini:", errorData);
                        finalResponse = `Desculpe, tive um problema ao conectar com a intelig√™ncia da rede. Tente novamente mais tarde. üò•`;
                    } else {
                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            finalResponse = result.candidates[0].content.parts[0].text;
                        } else {
                            console.warn("API Gemini n√£o retornou conte√∫do:", result);
                            finalResponse = `N√£o consegui gerar uma resposta agora. Por favor, tente novamente. üòî`;
                        }
                    }
                } catch (error) {
                    console.error("Erro de rede ao chamar a API Gemini:", error);
                    finalResponse = `Ocorreu um erro de rede ao tentar conectar com a IA. Por favor, verifique sua conex√£o. üåê`;
                }

                // Garante que um emoji esteja presente, caso o LLM n√£o tenha inclu√≠do um
                if (!/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}]/u.test(finalResponse)) {
                    finalResponse += ` ${profile.emojis.default}`;
                }

                this.chatHistory.push({ role: 'ai', text: finalResponse });
                return finalResponse;
            },

            // Ativa um plano de faturamento, iniciando a gera√ß√£o de lucro autom√°tico.
            activatePlan(planId, promoCode = null) {
                if (this.activePlanInterval) clearInterval(this.activePlanInterval);
                if (this.countdownInterval) clearInterval(this.countdownInterval); // Clear existing countdown

                const plan = Config.plans.find(p => p.id === planId);
                if (!plan) {
                    UI.showToast("Erro: Plano n√£o encontrado.", "error");
                    return;
                }

                let finalPrice = plan.price;
                let discountApplied = false;
                if (promoCode === "TURBO10" && plan.price >= 500) { // Exemplo de c√≥digo promocional
                    finalPrice *= 0.90; // 10% de desconto
                    discountApplied = true;
                    UI.showToast("C√≥digo promocional aplicado! 10% de desconto.", "info");
                }

                if (State.state.balance < finalPrice) {
                    UI.showToast(`Saldo insuficiente para ativar o plano ${plan.name}. Voc√™ precisa de ${finalPrice.toFixed(2)} MZN.`, "error");
                    IA.typeFloatingBubble("Seu saldo n√£o √© suficiente para ativar este plano. Por favor, fa√ßa um dep√≥sito para continuar.");
                    return;
                }

                // Simula√ß√£o de "Plano Surpresa" (10% de chance de lucro 2x)
                let profitMultiplier = plan.profitMultiplier;
                if (Math.random() < 0.10) { // 10% de chance
                    profitMultiplier = 2.0; // Lucro de 2x
                    UI.showToast("Parab√©ns! Plano Surpresa ativado! Lucro dobrado! ü•≥", "profit");
                    this.typeFloatingBubble("Surpresa! Seu plano teve um upgrade inesperado! Prepare-se para lucros ainda maiores!");
                }

                const profitTotal = finalPrice * profitMultiplier;
                const profit40 = profitTotal * 0.40;
                const profitRemaining = profitTotal - profit40;

                State.state.activePlan = {
                    ...plan,
                    pricePaid: finalPrice, // Pre√ßo real pago
                    profitMultiplier: profitMultiplier, // Multiplicador final
                    startTime: Date.now(),
                    endTime: Date.now() + plan.duration * 3600 * 1000,
                    profitCredited: 0,
                    profitTotal
                };
                
                const oldBalance = State.state.balance;
                State.state.balance -= finalPrice;
                UI.animateNumber(UI.qs('#balance-display'), oldBalance, State.state.balance); // Animate balance change
                
                State.addHistory('plan', `Plano ${plan.name} ativado${discountApplied ? ' (com desconto)' : ''}`, -finalPrice);
                
                this.typeFloatingBubble(`Plano ${plan.name} ativado! A IA Global de Vendas iniciou a opera√ß√£o. O primeiro lucro ser√° creditado em breve.`);

                // L√≥gica de B√¥nus Consecutivos e Retorno Crescente
                State.state.gamification.consecutivePlans = (State.state.gamification.consecutivePlans || 0) + 1;
                if (State.state.gamification.consecutivePlans >= 3) {
                    UI.showToast("B√¥nus por 3 planos consecutivos! Voc√™ ganhou um b√¥nus extra!", "profit");
                    const bonusAmount = 100;
                    const oldBalanceBonus = State.state.balance;
                    State.state.balance += bonusAmount; // Exemplo de b√¥nus
                    UI.animateNumber(UI.qs('#balance-display'), oldBalanceBonus, State.state.balance); // Animate bonus
                    State.addHistory('bonus', 'B√¥nus por planos consecutivos', bonusAmount);
                    State.state.gamification.consecutivePlans = 0; // Reseta o contador
                }
                // Simula√ß√£o de Retorno Crescente (aumenta o multiplicador base para o pr√≥ximo plano)
                // Isso seria mais complexo e persistente, mas aqui √© uma ideia.
                // if (State.state.gamification.consecutivePlans > 0) {
                //     State.state.settings.baseProfitMultiplier += 0.01; // Exemplo
                // }

                setTimeout(() => {
                    const oldBalance40 = State.state.balance;
                    State.state.balance += profit40;
                    UI.animateNumber(UI.qs('#balance-display'), oldBalance40, State.state.balance); // Animate profit
                    State.state.activePlan.profitCredited += profit40;
                    UI.showToast(`Lucro inicial de ${profit40.toFixed(2)} MZN!`, 'profit');
                    State.addHistory('profit', 'Lucro inicial (40%)', profit40);
                }, 20 * 1000);

                const totalDurationSeconds = plan.duration * 3600;
                const initialProfitDurationSeconds = 20;
                const remainingDurationSeconds = totalDurationSeconds - initialProfitDurationSeconds;

                // Credita o lucro restante ao longo da dura√ß√£o, a cada 10 segundos
                const numberOfIntervals = remainingDurationSeconds / 10;
                const profitPerInterval = profitRemaining / numberOfIntervals;
                
                this.activePlanInterval = setInterval(() => {
                    if (Date.now() >= State.state.activePlan.endTime) {
                        this.deactivatePlan();
                        return;
                    }
                    const credit = profitPerInterval;
                    const oldBalanceInterval = State.state.balance;
                    State.state.balance += credit;
                    UI.animateNumber(UI.qs('#balance-display'), oldBalanceInterval, State.state.balance); // Animate profit
                    State.state.activePlan.profitCredited += credit;
                    UI.showToast(`+${credit.toFixed(2)} MZN de lucro!`, 'profit');
                    State.addHistory('profit', 'Lucro autom√°tico', credit);
                    
                    // Simula√ß√£o de XP por lucro
                    State.state.gamification.xp += 1;
                    if (State.state.gamification.xp >= State.state.gamification.level * 100) {
                        State.state.gamification.level++;
                        State.state.gamification.xp = 0;
                        UI.showToast(`Parab√©ns! Voc√™ subiu para o N√≠vel ${State.state.gamification.level}! üéâ`, "achievement"); // Changed to achievement toast
                        IA.typeFloatingBubble(`Excelente! Voc√™ atingiu o N√≠vel ${State.state.gamification.level}. Seu sucesso √© a minha meta!`);
                    }
                }, 10 * 1000);

                // Start countdown clock
                this.startCountdown();

                State.save();
                App.updateDashboard();
            },

            // Starts the countdown timer for the active plan
            startCountdown() {
                if (this.countdownInterval) clearInterval(this.countdownInterval);
                const countdownElement = UI.qs('#plan-countdown');
                if (!countdownElement || !State.state.activePlan) return;

                this.countdownInterval = setInterval(() => {
                    const now = Date.now();
                    const timeLeft = State.state.activePlan.endTime - now;

                    if (timeLeft <= 0) {
                        clearInterval(this.countdownInterval);
                        countdownElement.textContent = 'Plano Conclu√≠do!';
                        return;
                    }

                    const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                    countdownElement.textContent = `Tempo restante: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }, 1000);
            },

            // Desativa o plano de faturamento ativo.
            deactivatePlan() {
                if (!this.activePlanInterval) return;
                clearInterval(this.activePlanInterval);
                this.activePlanInterval = null;
                if (this.countdownInterval) clearInterval(this.countdownInterval);
                
                this.typeFloatingBubble(`Plano ${State.state.activePlan.name} conclu√≠do com sucesso!`);
                UI.showToast(`Plano ${State.state.activePlan.name} conclu√≠do! Lucro total: ${State.state.activePlan.profitCredited.toFixed(2)} MZN. üéâ`, "success");
                
                // Simula√ß√£o de Alerta ao ultrapassar a meta de lucro
                if (State.state.activePlan.profitCredited > State.state.activePlan.profitTotal) {
                    UI.showToast("Parab√©ns! Voc√™ superou a meta de lucro do seu plano! üöÄ", "profit");
                }

                State.state.activePlan = null;
                State.save();
                App.updateDashboard();
            }
        };
        
        // --- M√ìDULO PRINCIPAL DA APLICA√á√ÉO ---
        // Cont√©m a l√≥gica principal de inicializa√ß√£o, navega√ß√£o e renderiza√ß√£o das telas.
        const App = {
            chartInstance: null, // Inst√¢ncia do gr√°fico Chart.js
            onlineStatusInterval: null, // Para simular detec√ß√£o de online/offline

            // Inicializa a aplica√ß√£o.
            init() {
                // Adiciona listeners de eventos globais
                window.addEventListener('hashchange', () => this.handleNavigation());
                UI.qs('#modal-overlay').addEventListener('click', UI.hideModal);
                UI.qs('#ai-voice-toggle').addEventListener('click', () => IA.typeFloatingBubble("Ol√°! Como posso ajudar?"));
                UI.qs('#login-form').addEventListener('submit', (e) => this.handleLogin(e));
                UI.qs('#forgot-password-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showForgotPasswordModal();
                });
                UI.qs('#create-account-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    UI.showScreen('#create-account-screen');
                });
                UI.qs('#back-to-login-link').addEventListener('click', (e) => {
                    e.preventDefault();
                    UI.showScreen('#login-screen');
                });
                UI.qs('#create-account-form').addEventListener('submit', (e) => this.handleCreateAccount(e));


                // Floating Action Button (FAB)
                UI.qs('#fab-main').addEventListener('click', () => {
                    UI.qs('#fab-menu').classList.toggle('active');
                });
                UI.qs('#fab-planos').addEventListener('click', () => { window.location.hash = 'plans'; UI.qs('#fab-menu').classList.remove('active'); });
                UI.qs('#fab-depositar').addEventListener('click', () => { App.showPaymentModal('p2'); UI.qs('#fab-menu').classList.remove('active'); }); // Exemplo: abre modal do Premium
                UI.qs('#fab-chat').addEventListener('click', () => { window.location.hash = 'ai-hub'; UI.qs('#fab-menu').classList.remove('active'); });
                UI.qs('#fab-historico').addEventListener('click', () => { window.location.hash = 'dashboard'; UI.qs('#fab-menu').classList.remove('active'); }); // Hist√≥rico est√° no dashboard

                // L√≥gica da tela de carregamento inicial
                setTimeout(() => {
                    UI.qs('#loading-screen').classList.add('fade-out-hard');
                    UI.qs('#loading-screen').addEventListener('animationend', () => {
                        UI.qs('#loading-screen').classList.add('hidden');
                        if (State.load()) { // Tenta carregar uma sess√£o existente
                            this.renderMainApp(); // Se houver, vai para a aplica√ß√£o principal
                        } else {
                            UI.showScreen('#login-screen'); // Caso contr√°rio, mostra a tela de login
                        }
                    }, { once: true }); // Executa o listener apenas uma vez
                }, 1500); // Tempo de exibi√ß√£o da tela de carregamento

                // Simula√ß√£o de detec√ß√£o de status online/offline
                this.onlineStatusInterval = setInterval(() => {
                    const isOnline = navigator.onLine;
                    if (State.state.offlineMode && isOnline) {
                        // Se a IA estava em modo offline e agora est√° online, reativa o plano
                        State.state.offlineMode = false;
                        if (State.state.activePlan) {
                            IA.activatePlan(State.state.activePlan.id); // Reativa o plano (reinicia o intervalo)
                            UI.showToast("Reconectado! Seu plano foi reativado.", "info");
                        }
                    } else if (!isOnline && !State.state.offlineMode) {
                        State.state.offlineMode = true;
                        if (IA.activePlanInterval) clearInterval(IA.activePlanInterval); // Pausa o lucro se ficar offline
                        UI.showToast("Voc√™ est√° offline. A IA continuar√° a operar em segundo plano.", "info");
                    }
                }, 5000); // Verifica a cada 5 segundos

                // Simula√ß√£o de verifica√ß√£o por n√∫mero (READ_PHONE_STATE)
                // Em um ambiente Android real, isso envolveria APIs nativas.
                // Aqui, √© apenas uma nota conceitual.
                console.log("Simulando READ_PHONE_STATE: Identificador do dispositivo (IMEI) seria lido aqui para seguran√ßa.");

                // Initial device performance detection
                this.detectDevicePerformance();
            },

            // Detects device performance and sets the appropriate performance mode
            detectDevicePerformance() {
                let performanceMode = 'economic'; // Default for low-end or unknown devices
                const deviceMemory = navigator.deviceMemory; // In GB

                if (deviceMemory !== undefined) {
                    if (deviceMemory >= 4) { // Devices with 4GB RAM or more
                        performanceMode = 'extreme'; // Mapped to 'extreme' for 4K quality
                    } else if (deviceMemory >= 2) { // Devices with 2GB RAM or more
                        performanceMode = 'hd';
                    }
                } else {
                    // Fallback for browsers that don't support navigator.deviceMemory
                    // Could use screen resolution, CPU cores (less reliable), etc.
                    // For now, default to economic if not detected.
                    const screenArea = window.screen.width * window.screen.height;
                    if (screenArea > (1920 * 1080 * 0.8)) { // Heuristic for larger screens (e.g., desktops, high-res tablets)
                        performanceMode = 'hd';
                    }
                }
                
                // Set the detected mode, but allow user override if already set
                if (!State.state.settings.performanceMode || State.state.settings.performanceMode === 'economic') { // Only auto-set if it's default or economic
                    State.state.settings.performanceMode = performanceMode;
                    UI.showToast(`Modo Gr√°fico definido para ${performanceMode.toUpperCase()} com base no seu dispositivo.`, 'info');
                }
                UI.applyPerformanceMode(State.state.settings.performanceMode);
            },

            // Agenda a ativa√ß√£o do Dark Mode com base na hora do dia
            scheduleDarkMode() {
                const now = new Date();
                const hour = now.getHours();
                // Ativa Dark Mode entre 18h e 6h
                if (hour >= 18 || hour < 6) {
                    if (State.state.settings.theme !== 'dark') {
                        State.state.settings.theme = 'dark';
                        UI.applyTheme('dark');
                        State.save();
                        UI.showToast("Modo Escuro ativado automaticamente! üåô", "info");
                    }
                } else {
                    if (State.state.settings.theme !== 'light') {
                        State.state.settings.theme = 'light';
                        UI.applyTheme('light');
                        State.save();
                        UI.showToast("Modo Claro ativado automaticamente! ‚òÄÔ∏è", "info");
                    }
                }
                // Verifica a cada hora
                setTimeout(() => this.scheduleDarkMode(), 3600 * 1000); 
            },

            // Lida com o processo de login do usu√°rio.
            handleLogin(e) {
                e.preventDefault();
                const userId = UI.qs('#account-id').value.trim();
                const password = UI.qs('#password').value.trim();
                if (!userId || !password) return UI.showToast("Preencha todos os campos.", "error");

                const accounts = JSON.parse(localStorage.getItem('iaTurboAccounts')) || {};
                const loadedState = accounts[userId] ? JSON.parse(accounts[userId]) : null;

                if (!loadedState) {
                    // Se a conta n√£o existe, redireciona para criar conta
                    UI.showToast("Conta n√£o encontrada. Por favor, crie uma nova conta.", "info");
                    UI.showScreen('#create-account-screen');
                    UI.qs('#new-user-phone').value = userId; // Preenche o campo de telefone com o ID digitado
                    return;
                } else {
                    // Se a conta existe, tenta fazer login
                    State.load(); // Carrega o estado da conta existente
                    if (State.state.password !== password) {
                        return UI.showToast("Senha incorreta.", "error");
                    }
                    UI.showToast("Login bem-sucedido!");
                }
                
                this.renderMainApp(); // Login/Cria√ß√£o bem-sucedida, renderiza a aplica√ß√£o principal
            },

            // Lida com o processo de cria√ß√£o de conta.
            handleCreateAccount(e) {
                e.preventDefault();
                const userName = UI.qs('#new-user-name').value.trim();
                const userPhone = UI.qs('#new-user-phone').value.trim();
                const password = UI.qs('#new-user-password').value.trim();
                const pin = UI.qs('#new-user-pin').value.trim();

                if (!userName || !userPhone || !password || !pin) {
                    return UI.showToast("Preencha todos os campos para criar a conta.", "error");
                }
                if (pin.length !== 4 || isNaN(pin)) {
                    return UI.showToast("O PIN de seguran√ßa deve ter 4 d√≠gitos num√©ricos.", "error");
                }

                const accounts = JSON.parse(localStorage.getItem('iaTurboAccounts')) || {};
                if (Object.values(accounts).some(acc => JSON.parse(acc).userPhone === userPhone)) {
                    return UI.showToast("Este n√∫mero de telefone j√° est√° registado.", "error");
                }

                State.create(userName, userPhone, password, pin);
                UI.showToast(`Conta criada com sucesso! Seu ID √©: ${State.state.userId}.`, "success");
                this.renderMainApp();
            },

            // Mostra o modal de "Esqueci a Senha"
            showForgotPasswordModal() {
                UI.showModal('Esqueci a Senha',
                    `<p class="text-center text-secondary mb-4">Para sua seguran√ßa, a recupera√ß√£o de senha √© feita atrav√©s do nosso suporte e requer um novo dep√≥sito m√≠nimo para reativa√ß√£o da conta.</p>
                     <p class="text-center text-secondary mb-4">Por favor, contacte o suporte com seu IMEI e um print do seu saldo para verificar sua identidade.</p>
                     <p class="text-center text-red-500 text-sm">Esta √© uma funcionalidade simulada para fins de demonstra√ß√£o.</p>`,
                    `<button id="forgot-password-understood-btn" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition">Entendido</button>`
                );
                UI.qs('#forgot-password-understood-btn').addEventListener('click', UI.hideModal);
            },

            // Renderiza a estrutura principal da aplica√ß√£o ap√≥s o login.
            renderMainApp() {
                UI.showScreen('#app-container');
                UI.qs('#ai-assistant-container').classList.remove('hidden');
                this.renderNav(); // Renderiza a barra de navega√ß√£o
                // Aplica o tema salvo nas configura√ß√µes do usu√°rio
                UI.applyTheme(State.state.settings.theme);
                // Aplica o modo de alto contraste
                UI.applyHighContrast(State.state.settings.highContrast);
                // Aplica o modo de desempenho
                UI.applyPerformanceMode(State.state.settings.performanceMode);
                // Aplica o tamanho da fonte salvo
                document.documentElement.style.fontSize = State.state.settings.fontSize === 'large' ? '1.1em' : (State.state.settings.fontSize === 'small' ? '0.9em' : '1em');
                // Aplica o estilo de texto
                UI.applyTextStyle(State.state.settings.textStyle);
                // Aplica a cor dos bot√µes
                UI.applyButtonColors(State.state.settings.buttonColor);
                // Aplica o modo de layout do dispositivo
                UI.applyDeviceLayoutMode(State.state.settings.deviceLayoutMode);

                // Navega para o dashboard ou para a hash atual na URL
                window.location.hash = window.location.hash || 'dashboard';
                this.handleNavigation();
                // Agendamento do Dark Mode ap√≥s o estado ser carregado/criado
                this.scheduleDarkMode();
                // Mostra o FAB
                UI.qs('#fab-menu').classList.remove('hidden');

                // If a plan is active, start the countdown
                if (State.state.activePlan) {
                    IA.startCountdown();
                }
            },

            // Renderiza os itens da barra de navega√ß√£o inferior.
            renderNav() {
                UI.render('#bottom-nav', Config.nav.map(item => `
                    <a href="#${item.id}" class="nav-item flex-1 flex flex-col items-center justify-center p-2 transition-colors rounded-lg hover:bg-tertiary" data-tab="${item.id}" data-tooltip="${item.label}">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="${item.icon}" /></svg>
                        <span class="text-xs mt-1">${item.label}</span>
                    </a>
                `).join(''));
            },

            // Lida com a navega√ß√£o entre as abas da aplica√ß√£o.
            handleNavigation() {
                const hash = window.location.hash.substring(1) || 'dashboard';
                // Atualiza o estilo do item de navega√ß√£o ativo
                UI.qsa('.nav-item').forEach(item => {
                    const is_active = item.dataset.tab === hash;
                    item.classList.toggle('text-accent', is_active);
                    item.classList.toggle('text-secondary', !is_active);
                });
                this.renderScreen(hash); // Renderiza o conte√∫do da tela correspondente
            },
            
            // Atualiza o saldo e informa√ß√µes do usu√°rio no cabe√ßalho.
            updateDashboard() {
                const balanceDisplayElement = UI.qs('#balance-display');
                if (balanceDisplayElement) {
                    // Only animate if the value actually changes
                    const currentDisplayedBalance = parseFloat(balanceDisplayElement.textContent.replace('MZN ', ''));
                    if (currentDisplayedBalance !== State.state.balance) {
                        UI.animateNumber(balanceDisplayElement, currentDisplayedBalance, State.state.balance);
                    }
                }

                const userInfoDiv = UI.qs('#user-info');
                userInfoDiv.innerHTML = `
                    <p class="font-semibold text-primary user-id-animated">${State.state.userName} (${State.state.userId})</p>
                    <p class="text-xs px-2 py-1 rounded-full ${State.state.activePlan ? 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100' : 'bg-tertiary text-secondary'}">
                        ${State.state.activePlan ? 'Plano Ativo' : 'Sem Plano'}
                    </p>
                    <p class="text-xs text-secondary">N√≠vel: ${State.state.gamification.level} (XP: ${State.state.gamification.xp})</p>
                    <p class="text-xs text-secondary">Vers√£o: ${State.state.version}</p>
                    <p class="text-xs text-secondary">Status: <span class="${navigator.onLine ? 'text-green-500' : 'text-red-500'}">${navigator.onLine ? 'Online' : 'Offline'}</span></p>
                `;
                // Adiciona a classe de anima√ß√£o ao ID do usu√°rio
                const userIdElement = userInfoDiv.querySelector('.user-id-animated');
                if (userIdElement) {
                    userIdElement.classList.remove('user-id-animated'); // Remove para permitir re-anima√ß√£o
                    void userIdElement.offsetWidth; // For√ßa reflow
                    userIdElement.classList.add('user-id-animated');
                }

                // Atualiza a barra de meta no dashboard se estiver vis√≠vel
                if (window.location.hash === '#dashboard') {
                    const weeklyProfit = State.state.history.filter(i => i.type === 'profit' && new Date(i.date) >= new Date(State.state.gamification.lastWeeklyReset)).reduce((sum, i) => sum + i.amount, 0);
                    const goalPercentage = Math.min(100, (weeklyProfit / State.state.gamification.weeklyGoal) * 100);
                    const goalBar = UI.qs('#weekly-goal-progress');
                    const goalText = UI.qs('#weekly-goal-text');

                    if (goalBar && goalText) {
                        // Animate width of the progress bar
                        goalBar.style.width = `${goalPercentage}%`;
                        
                        // Animate the percentage text
                        const currentDisplayedPercentage = parseFloat(goalText.textContent.match(/\(([^%]+)%\)/)?.[1] || 0);
                        const animatePercentage = (start, end, duration) => {
                            let startTime;
                            const animate = (currentTime) => {
                                if (!startTime) startTime = currentTime;
                                const progress = Math.min((currentTime - startTime) / duration, 1);
                                const currentValue = start + (end - start) * progress;
                                goalText.textContent = `Meta: ${State.state.gamification.weeklyGoal.toFixed(2)} MZN esta semana (${currentValue.toFixed(1)}%)`;
                                if (progress < 1) {
                                    requestAnimationFrame(animate);
                                }
                            };
                            requestAnimationFrame(animate);
                        };
                        animatePercentage(currentDisplayedPercentage, goalPercentage, 1000); // 1 second animation

                        if (goalPercentage >= 100 && !State.state.gamification.goalAchieved) {
                            UI.showToast("Parab√©ns! Voc√™ atingiu sua meta semanal! üèÜ", "achievement");
                            State.state.gamification.goalAchieved = true; // Marca como atingida para n√£o repetir
                            State.save();
                        } else if (goalPercentage < 100 && State.state.gamification.goalAchieved) {
                            State.state.gamification.goalAchieved = false; // Reseta se o lucro cair abaixo da meta
                            State.save();
                        }
                    }
                }
            },

            // Renderiza o conte√∫do da tela principal com base no ID da tela.
            renderScreen(screenId) {
                const container = UI.qs('#app-content');
                // Limpa o conte√∫do anterior para evitar duplica√ß√£o de elementos e listeners
                container.innerHTML = ''; 
                switch(screenId) {
                    case 'dashboard': this.renderDashboard(container); break;
                    case 'plans': this.renderPlans(container); break;
                    case 'chart': this.renderChart(container); break;
                    case 'ai-hub': this.renderAIHub(container); break;
                    case 'settings': this.renderSettings(container); break;
                    default: this.renderDashboard(container); // Fallback
                }
                this.updateDashboard(); // Atualiza o cabe√ßalho ap√≥s renderizar a tela
            },

            // Renderiza a tela do Dashboard.
            renderDashboard(container) {
                const plan = State.state.activePlan;
                let nextProfitTime = '';
                if (plan) {
                    const timeElapsed = (Date.now() - plan.startTime) / 1000; // Tempo decorrido em segundos
                    const timeRemaining = Math.max(0, (plan.duration * 3600) - timeElapsed); // Tempo restante em segundos
                    const progress = Math.min(100, (timeElapsed / (plan.duration * 3600)) * 100); // Progresso em porcentagem

                    // Calcular tempo para o pr√≥ximo lucro (a cada 10 segundos ap√≥s os primeiros 20 segundos)
                    if (timeElapsed < 20) { // Primeiros 20 segundos
                        nextProfitTime = `Primeiro lucro em ${Math.max(0, 20 - Math.floor(timeElapsed))}s`;
                    } else {
                        const secondsSinceInitialProfit = timeElapsed - 20;
                        const timeToNextInterval = 10 - (secondsSinceInitialProfit % 10);
                        nextProfitTime = `Pr√≥ximo lucro em ${Math.floor(timeToNextInterval)}s`;
                    }

                    UI.render(container, `
                        <div class="bg-gradient-to-br ${plan.color} text-white p-6 rounded-2xl shadow-lg slide-in-up">
                            <h2 class="text-2xl font-bold">Plano ${plan.name} Ativo</h2>
                            <div class="mt-6">
                                <p class="text-sm flex justify-between"><span>Progresso</span><span>${progress.toFixed(1)}%</span></p>
                                <div class="w-full bg-white/20 rounded-full h-2.5 mt-1"><div class="bg-white h-2.5 rounded-full progress-bar-fill" style="width: ${progress}%"></div></div>
                                <p id="plan-countdown" class="text-xs text-right mt-1 opacity-80">Tempo restante: ${new Date(timeRemaining * 1000).toISOString().substr(11, 8)}</p>
                            </div>
                            <div class="mt-4">
                                <p class="text-sm">Lucro Gerado / Meta</p>
                                <p class="text-xl font-bold">${plan.profitCredited.toFixed(2)} / ${plan.profitTotal.toFixed(2)} MZN</p>
                            </div>
                            <div class="mt-4 text-center text-sm font-semibold">
                                <p>${nextProfitTime}</p>
                            </div>
                        </div>
                        <div class="mt-6">
                            <h3 class="font-bold text-lg mb-2 text-primary">Relat√≥rio Di√°rio de Lucros</h3>
                            <p class="text-secondary text-sm mb-4">Seu lucro total hoje: <span class="font-bold text-green-500">MZN ${State.state.history.filter(i => i.type === 'profit' && new Date(i.date).toDateString() === new Date().toDateString()).reduce((sum, i) => sum + i.amount, 0).toFixed(2)}</span></p>
                            
                            <h3 class="font-bold text-lg mb-2 text-primary">Meta Semanal de Lucro</h3>
                            <div class="bg-tertiary text-primary rounded-lg p-3 mb-4">
                                <p class="text-sm text-secondary" id="weekly-goal-text">Meta: ${State.state.gamification.weeklyGoal.toFixed(2)} MZN esta semana (${Math.min(100, (State.state.history.filter(i => i.type === 'profit' && new Date(i.date) >= new Date(State.state.gamification.lastWeeklyReset)).reduce((sum, i) => sum + i.amount, 0) / State.state.gamification.weeklyGoal) * 100).toFixed(1)}%)</p>
                                <div class="w-full bg-border-color rounded-full h-2.5 mt-1">
                                    <div id="weekly-goal-progress" class="bg-blue-500 h-2.5 rounded-full transition-all duration-500 progress-bar-fill" style="width: ${Math.min(100, (State.state.history.filter(i => i.type === 'profit' && new Date(i.date) >= new Date(State.state.gamification.lastWeeklyReset)).reduce((sum, i) => sum + i.amount, 0) / State.state.gamification.weeklyGoal) * 100)}%"></div>
                                </div>
                            </div>

                            <h3 class="font-bold text-lg mb-2 text-primary">Hist√≥rico Recente</h3>
                            <div class="space-y-2">
                                ${State.state.history.slice(0, 5).map(item => `
                                    <div class="bg-tertiary text-primary p-3 rounded-lg flex justify-between items-center text-sm">
                                        <p class="font-semibold">${item.description}</p>
                                        <span class="font-bold ${item.type === 'profit' ? 'text-green-500' : 'text-red-500'}">
                                            ${item.type === 'profit' ? '+' : ''}${item.amount.toFixed(2)}
                                        </span>
                                    </div>
                                `).join('') || '<p class="text-secondary text-center p-4">Nenhuma atividade recente.</p>'}
                            </div>
                        </div>
                    `);
                    // If a plan is active, start the countdown
                    if (State.state.activePlan) {
                        IA.startCountdown();
                    }
                } else {
                    UI.render(container, `
                        <div class="text-center p-8 bg-tertiary text-primary rounded-2xl slide-in-up">
                            <h2 class="text-2xl font-bold">Ol√°, ${State.state.userName}!</h2>
                            <p class="text-secondary mt-2 mb-6">Pronto para transformar suas ideias em lucro? Ative um plano e deixe a IA trabalhar para si.</p>
                            <a href="#plans" class="w-full block bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition">Ver Planos de Faturamento</a>
                            <button id="ai-start-from-zero" class="w-full mt-4 bg-purple-500 text-white font-bold py-3 rounded-lg hover:bg-purple-600 transition" data-tooltip="Pe√ßa √† IA para te ajudar a come√ßar do zero">‚ú® Come√ßar do Zero com a IA</button>
                        </div>
                        <div class="mt-6">
                            <h3 class="font-bold text-lg mb-2 text-primary">Simulador de Lucro</h3>
                            <div class="flex gap-2">
                                <input type="number" id="sim-value" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Valor do dep√≥sito">
                                <button id="sim-btn" class="bg-accent text-white font-bold px-4 rounded-lg hover:opacity-90 transition" data-tooltip="Simular lucro para todos os planos">Simular</button>
                            </div>
                            <div id="sim-result" class="mt-2 space-y-2"></div>
                        </div>
                        <div class="mt-6">
                            <h3 class="font-bold text-lg mb-2 text-primary">IA Ativa: Dicas de Vendas</h3>
                            <div class="bg-tertiary text-primary p-4 rounded-lg">
                                <p class="text-secondary text-sm">"Sua IA est√° sempre a postos! Uma dica r√°pida: foque no problema que seu produto resolve, n√£o apenas nas caracter√≠sticas. Isso conecta com o cliente!"</p>
                            </div>
                        </div>
                        <div class="mt-6">
                            <h3 class="font-bold text-lg mb-2 text-primary">Cart√£o Virtual IA Turbo</h3>
                            <div id="virtual-card-wrapper" class="virtual-card-container w-full h-52 relative">
                                <div id="virtual-card" class="virtual-card">
                                    <div class="card-face card-front bg-gradient-to-br from-blue-600 to-purple-700">
                                        <div>
                                            <p class="text-sm opacity-80">Nome do Titular</p>
                                            <p class="text-lg font-semibold">${State.state.userName}</p>
                                        </div>
                                        <div>
                                            <p class="text-sm opacity-80">N√∫mero do Cart√£o Virtual</p>
                                            <p class="text-xl font-mono tracking-wider mt-1">${State.state.virtualCard.number}</p>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="text-xs opacity-80">Validade</p>
                                                <p class="text-sm font-semibold">${State.state.virtualCard.validity}</p>
                                            </div>
                                            <p class="text-right text-xs opacity-80">IA Turbo Card</p>
                                        </div>
                                    </div>
                                    <div class="card-face card-back">
                                        <div class="card-magnetic-strip"></div>
                                        <div class="flex justify-end mt-4">
                                            <p class="text-xs opacity-80 mr-2">CVV</p>
                                            <div class="card-cvv-box">${State.state.virtualCard.cvv}</div>
                                        </div>
                                        <div class="flex justify-center mt-4">
                                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=80x80&data=${encodeURIComponent(State.state.userId)}" alt="QR Code" class="w-20 h-20">
                                        </div>
                                        <p class="text-xs text-center mt-2 text-secondary">Escaneie para detalhes da conta</p>
                                    </div>
                                </div>
                            </div>
                            <button id="flip-card-btn" class="w-full mt-4 bg-accent text-white font-bold py-2 rounded-lg hover:opacity-90 transition" data-tooltip="Virar o cart√£o virtual">Virar Cart√£o</button>
                            <button id="copy-card-number-btn" class="w-full mt-2 bg-blue-500 text-white font-bold py-2 rounded-lg hover:bg-blue-600 transition" data-tooltip="Copiar o n√∫mero completo do cart√£o">Copiar N√∫mero do Cart√£o</button>
                            <button id="transfer-virtual-btn" class="w-full mt-2 bg-blue-500 text-white font-bold py-2 rounded-lg hover:bg-blue-600 transition" data-tooltip="Transferir entre contas virtuais IA Turbo">Transferir entre Contas IA Turbo</button>
                        </div>
                    `);
                    // Adiciona listener para o bot√£o do simulador
                    UI.qs('#sim-btn').addEventListener('click', () => {
                        const value = parseFloat(UI.qs('#sim-value').value);
                        const simResultContainer = UI.qs('#sim-result');
                        simResultContainer.innerHTML = ''; // Limpa resultados anteriores

                        if (!value || isNaN(value) || value <= 0) {
                            UI.render(simResultContainer, `<p class="text-red-500 p-3 bg-red-100 rounded-lg">Por favor, insira um valor v√°lido.</p>`);
                            return;
                        }

                        let simulationHtml = `
                            <p class="text-secondary p-3 bg-tertiary text-primary rounded-lg font-semibold">
                                Com ${value.toFixed(2)} MZN, seus lucros estimados seriam:
                            </p>
                            <ul class="space-y-1 mt-2">
                        `;
                        Config.plans.forEach(plan => {
                            const estimatedProfit = value * plan.profitMultiplier;
                            const profitPercentage = ((estimatedProfit - value) / value * 100).toFixed(0);
                            simulationHtml += `
                                <li class="bg-tertiary text-primary p-2 rounded-lg flex justify-between items-center">
                                    <span class="font-semibold">${plan.name}:</span>
                                    <span class="text-green-500 font-bold">${estimatedProfit.toFixed(2)} MZN (+${profitPercentage}%)</span>
                                </li>
                            `;
                        });
                        simulationHtml += `</ul>`;
                        UI.render(simResultContainer, simulationHtml);
                    });

                    // Virtual Card Listeners
                    UI.qs('#flip-card-btn').addEventListener('click', () => {
                        UI.qs('#virtual-card').classList.toggle('flipped');
                    });
                    UI.qs('#copy-card-number-btn').addEventListener('click', () => {
                        const cardNumber = State.state.virtualCard.number.replace(/\s/g, ''); // Remove espa√ßos
                        const el = document.createElement('textarea');
                        el.value = cardNumber;
                        document.body.appendChild(el);
                        el.select();
                        document.execCommand('copy');
                        document.body.removeChild(el);
                        UI.showToast('N√∫mero do cart√£o copiado!');
                    });
                    UI.qs('#transfer-virtual-btn').addEventListener('click', () => {
                        UI.showModal('Transfer√™ncia Virtual',
                            `<p class="text-center text-secondary mb-4">Simula√ß√£o de transfer√™ncia entre contas IA Turbo.</p>
                             <input type="text" id="target-account-id" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="ID da Conta Destino">
                             <input type="number" id="transfer-amount" class="w-full p-3 mt-2 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Valor a Transferir">`,
                            `<button id="confirm-transfer-btn" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition">Confirmar Transfer√™ncia</button>`
                        );
                        UI.qs('#confirm-transfer-btn').addEventListener('click', () => {
                            const targetId = UI.qs('#target-account-id').value.trim();
                            const amount = parseFloat(UI.qs('#transfer-amount').value);
                            if (targetId && amount > 0 && State.state.balance >= amount) {
                                State.state.balance -= amount;
                                State.addHistory('transfer_out', `Transfer√™ncia para ${targetId}`, -amount);
                                UI.showToast(`Transferido ${amount.toFixed(2)} MZN para ${targetId} (simulado).`, 'success');
                                UI.hideModal();
                            } else {
                                UI.showToast("Dados inv√°lidos ou saldo insuficiente para transfer√™ncia.", 'error');
                            }
                        });
                    });

                    // New LLM-powered button for "Start from Zero"
                    UI.qs('#ai-start-from-zero').addEventListener('click', () => {
                        window.location.hash = 'ai-hub'; // Navigate to AI Hub
                        setTimeout(() => { // Give time for navigation to complete
                            const aiInput = UI.qs('#ai-input');
                            if (aiInput) {
                                aiInput.value = "Como posso come√ßar do zero no empreendedorismo?";
                                UI.qs('#ai-send').click(); // Simulate click to send
                            }
                        }, 100);
                    });
                }
            },

            // Renderiza a tela de Planos.
            renderPlans(container) {
                UI.render(container, `
                    <h2 class="text-2xl font-bold mb-4 text-primary">Planos de Faturamento</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${Config.plans.map(p => `
                            <div class="plan-card bg-gradient-to-br ${p.color} text-white rounded-2xl p-5 flex flex-col shadow-lg">
                                <h3 class="text-xl font-bold">${p.name}</h3>
                                <p class="text-3xl font-extrabold my-2">${p.price}<span class="text-base font-normal opacity-80"> MZN</span></p>
                                <ul class="space-y-1 text-sm opacity-90 mt-2 flex-grow">
                                    <li><strong>Retorno Estimado:</strong> ${(p.profitMultiplier * p.price).toFixed(2)} MZN</li>
                                    <li><strong>Dura√ß√£o:</strong> ${p.duration} horas</li>
                                    <li><strong>Retorno Crescente:</strong> +0.1x por uso cont√≠nuo (simulado)</li>
                                </ul>
                                <button data-plan-id="${p.id}" class="buy-plan-btn mt-4 w-full bg-white/20 backdrop-blur-sm font-bold py-2 rounded-lg hover:bg-white/30 transition ${State.state.balance < p.price ? 'opacity-50 cursor-not-allowed' : ''}" ${State.state.balance < p.price ? 'disabled' : ''} data-tooltip="${State.state.balance < p.price ? 'Saldo insuficiente' : 'Ativar o plano ' + p.name}">Ativar</button>
                            </div>
                        `).join('')}
                    </div>
                    <div class="mt-6 p-4 bg-tertiary text-primary rounded-lg">
                        <h3 class="font-bold text-lg mb-2">C√≥digos Promocionais</h3>
                        <div class="flex gap-2">
                            <input type="text" id="promo-code-input" class="w-full p-3 bg-secondary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Inserir c√≥digo promocional">
                            <button id="apply-promo-btn" class="bg-accent text-white font-bold px-4 rounded-lg hover:opacity-90 transition">Aplicar</button>
                        </div>
                    </div>
                `);
                // Adiciona listeners para os bot√µes de compra de plano
                UI.qsa('.buy-plan-btn').forEach(btn => btn.addEventListener('click', (e) => {
                    const promoCode = UI.qs('#promo-code-input').value.trim();
                    this.showPaymentModal(e.target.dataset.planId, promoCode);
                }));
            },

            // Exibe o modal de pagamento para ativar um plano.
            showPaymentModal(planId, promoCode = null) {
                const plan = Config.plans.find(p => p.id === planId);
                if (!plan) {
                    UI.showToast("Plano n√£o encontrado.", "error");
                    return;
                }
                
                let finalPrice = plan.price;
                if (promoCode === "TURBO10" && plan.price >= 500) { // Exemplo de c√≥digo promocional
                    finalPrice *= 0.90; // 10% de desconto
                }

                if (State.state.balance < finalPrice) {
                    UI.showToast(`Saldo insuficiente para ativar o plano ${plan.name}. Voc√™ precisa de ${finalPrice.toFixed(2)} MZN.`, "error");
                    IA.typeFloatingBubble("Seu saldo n√£o √© suficiente para ativar este plano. Por favor, fa√ßa um dep√≥sito para continuar.");
                    return;
                }

                // Renderiza o modal com abas de pagamento
                UI.showModal(`Ativar ${plan.name}`,
                    `<p class="text-center text-secondary mb-4">Valor do Plano: <strong>${finalPrice.toFixed(2)} MZN</strong></p>
                    <div class="flex justify-center gap-2 mb-4 payment-tabs">
                        <button id="tab-mobile" data-method="mobile" class="${State.state.settings.paymentMethod === 'mobile' ? 'active' : ''}">Carteira M√≥vel</button>
                        <button id="tab-card" data-method="card" class="${State.state.settings.paymentMethod === 'card' ? 'active' : ''}">Cart√£o Virtual</button>
                        <button id="tab-qr" data-method="qr" class="${State.state.settings.paymentMethod === 'qr' ? 'active' : ''}">QR Code</button>
                    </div>
                    <div id="payment-content"></div>`,
                    `<button id="confirm-btn" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition" data-tooltip="Confirmar pagamento e ativar plano">Confirmar e Ativar</button>`
                );

                const paymentContentDiv = UI.qs('#payment-content');
                const confirmBtn = UI.qs('#confirm-btn');

                // Function to render specific payment method content
                const renderPaymentMethod = (method) => {
                    State.state.settings.paymentMethod = method; // Salva o m√©todo escolhido
                    UI.qsa('.payment-tabs button').forEach(btn => btn.classList.remove('active'));
                    UI.qs(`#tab-${method}`).classList.add('active');

                    let content = '';
                    switch (method) {
                        case 'mobile':
                            content = `
                                <p class="text-center text-secondary mb-4">Transfira exatamente <strong>${finalPrice.toFixed(2)} MZN</strong> para a conta abaixo.</p>
                                <div class="bg-tertiary text-primary p-3 rounded-lg text-center">
                                    <p class="text-sm text-secondary">N√∫mero para dep√≥sito:</p>
                                    <p class="text-2xl font-bold my-1 text-red-500">+258 868246949</p>
                                    <button id="copy-btn" class="text-xs bg-accent/10 text-accent px-2 py-1 rounded hover:bg-accent/20 transition" data-tooltip="Copiar n√∫mero de telefone">Copiar</button>
                                </div>
                                <div class="grid grid-cols-2 gap-2 mt-4">
                                    <a href="tel:*150%23" class="text-center p-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition" data-tooltip="Abrir M-Pesa">M-Pesa</a>
                                    <a href="tel:*898%23" class="text-center p-3 bg-orange-500 text-white rounded-lg font-semibold hover:bg-orange-600 transition" data-tooltip="Abrir e-Mola">e-Mola</a>
                                </div>
                                <input type="text" id="tx-id" class="w-full p-3 mt-4 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="ID da transa√ß√£o (ex: 10378056)" data-tooltip="Insira o ID da transa√ß√£o da sua carteira m√≥vel">
                                <input type="number" id="amount-sent" class="w-full p-3 mt-2 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Valor Enviado" value="${finalPrice.toFixed(2)}" step="0.01">
                            `;
                            break;
                        case 'card':
                            content = `
                                <p class="text-center text-secondary mb-4">Pague usando seu cart√£o virtual IA Turbo.</p>
                                <div class="bg-tertiary text-primary p-3 rounded-lg text-center">
                                    <p class="text-sm text-secondary">N√∫mero do Cart√£o:</p>
                                    <p class="text-xl font-bold my-1">${State.state.virtualCard.number}</p>
                                    <p class="text-sm text-secondary">Validade: ${State.state.virtualCard.validity} | CVV: ${State.state.virtualCard.cvv}</p>
                                    <button id="copy-card-modal-btn" class="text-xs bg-accent/10 text-accent px-2 py-1 rounded hover:bg-accent/20 transition" data-tooltip="Copiar n√∫mero do cart√£o">Copiar Cart√£o</button>
                                </div>
                                <input type="text" id="card-input-number" class="w-full p-3 mt-4 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="N√∫mero do Cart√£o" value="${State.state.virtualCard.number}" readonly>
                                <div class="flex gap-2 mt-2">
                                    <input type="text" id="card-input-validity" class="w-1/2 p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="MM/AA" value="${State.state.virtualCard.validity}" readonly>
                                    <input type="text" id="card-input-cvv" class="w-1/2 p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="CVV" value="${State.state.virtualCard.cvv}" readonly>
                                </div>
                                <button id="request-new-card-btn" class="w-full mt-4 bg-blue-500 text-white font-bold py-2 rounded-lg hover:bg-blue-600 transition">Solicitar Novo Cart√£o (Simulado)</button>
                            `;
                            break;
                        case 'qr':
                            const qrData = `ia-turbo-payment://${planId}/${finalPrice.toFixed(2)}/${State.state.userId}`;
                            content = `
                                <p class="text-center text-secondary mb-4">Escaneie o QR Code para pagar <strong>${finalPrice.toFixed(2)} MZN</strong>.</p>
                                <div class="flex justify-center p-4 bg-white rounded-lg">
                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(qrData)}" alt="QR Code de Pagamento" class="w-32 h-32">
                                </div>
                                <p class="text-center text-xs text-secondary mt-2">ID da Transa√ß√£o: <span id="qr-tx-id">${Math.random().toString(36).substring(2, 10).toUpperCase()}</span></p>
                                <button id="copy-qr-tx-id-btn" class="w-full mt-4 bg-accent/10 text-accent font-bold py-2 rounded-lg hover:bg-accent/20 transition">Copiar ID da Transa√ß√£o QR</button>
                            `;
                            break;
                    }
                    UI.render(paymentContentDiv, content);

                    // Add specific listeners for rendered content
                    if (method === 'mobile') {
                        UI.qs('#copy-btn').addEventListener('click', () => { 
                            const el = document.createElement('textarea');
                            el.value = '+258 868246949';
                            document.body.appendChild(el);
                            el.select();
                            document.execCommand('copy');
                            document.body.removeChild(el);
                            UI.showToast('N√∫mero copiado!'); 
                        });
                    } else if (method === 'card') {
                        UI.qs('#copy-card-modal-btn').addEventListener('click', () => {
                            const cardNumber = State.state.virtualCard.number.replace(/\s/g, '');
                            const el = document.createElement('textarea');
                            el.value = cardNumber;
                            document.body.appendChild(el);
                            el.select();
                            document.execCommand('copy');
                            document.body.removeChild(el);
                            UI.showToast('N√∫mero do cart√£o copiado!');
                        });
                        UI.qs('#request-new-card-btn').addEventListener('click', () => {
                            UI.showToast("Solicita√ß√£o de novo cart√£o virtual enviada (simulado).", "info");
                            IA.typeFloatingBubble("Um novo cart√£o virtual ser√° gerado em breve para voc√™! (Simulado)");
                        });
                    } else if (method === 'qr') {
                        UI.qs('#copy-qr-tx-id-btn').addEventListener('click', () => {
                            const qrTxId = UI.qs('#qr-tx-id').textContent;
                            const el = document.createElement('textarea');
                            el.value = qrTxId;
                            document.body.appendChild(el);
                            el.select();
                            document.execCommand('copy');
                            document.body.removeChild(el);
                            UI.showToast('ID da Transa√ß√£o QR copiado!');
                        });
                    }
                };

                // Initial render based on saved preference
                renderPaymentMethod(State.state.settings.paymentMethod);

                // Tab listeners
                UI.qs('#tab-mobile').addEventListener('click', () => renderPaymentMethod('mobile'));
                UI.qs('#tab-card').addEventListener('click', () => renderPaymentMethod('card'));
                UI.qs('#tab-qr').addEventListener('click', () => renderPaymentMethod('qr'));

                // Confirm button logic
                confirmBtn.addEventListener('click', () => {
                    let isValid = true;
                    let message = "";

                    if (State.state.settings.paymentMethod === 'mobile') {
                        const transactionId = UI.qs('#tx-id').value.trim().toLowerCase();
                        const amountSent = parseFloat(UI.qs('#amount-sent').value);

                        if (!transactionId || isNaN(amountSent) || amountSent <= 0) {
                            isValid = false;
                            message = "Preencha o ID da transa√ß√£o e o valor enviado.";
                        } else if (amountSent !== finalPrice) {
                            isValid = false;
                            message = `O valor enviado deve ser exatamente ${finalPrice.toFixed(2)} MZN.`;
                        } else if (!['10378056', '171780', '6432879'].includes(transactionId)) { // Simula√ß√£o de IDs v√°lidos
                            isValid = false;
                            message = "ID da transa√ß√£o inv√°lido. Por favor, use um dos c√≥digos de refer√™ncia fornecidos.";
                        }
                    } else if (State.state.settings.paymentMethod === 'card') {
                        // Card details are pre-filled and read-only, so just check balance
                        if (State.state.balance < finalPrice) {
                            isValid = false;
                            message = "Saldo insuficiente no cart√£o virtual para esta transa√ß√£o.";
                        }
                    } else if (State.state.settings.paymentMethod === 'qr') {
                        // QR code payment is assumed instant after scan, no extra input
                        if (State.state.balance < finalPrice) {
                            isValid = false;
                            message = "Saldo insuficiente para pagamento via QR Code.";
                        }
                    }

                    if (!isValid) {
                        UI.showToast(message, "error");
                        IA.typeFloatingBubble(message);
                        return;
                    }

                    UI.hideModal();
                    UI.showToast("A confirmar pagamento...", "info");
                    setTimeout(() => {
                        IA.activatePlan(planId, promoCode);
                        UI.showToast("Pagamento confirmado! Plano ativado.", "success");
                        IA.typeFloatingBubble("Pagamento recebido e plano ativado com sucesso! Prepare-se para o lucro!");
                        UI.showToast("Comprovativo enviado para o seu email (simulado).", "info");
                    }, 2000);
                });
            },

            // Renderiza a tela de Gr√°ficos.
            renderChart(container) {
                UI.render(container, `
                    <h2 class="text-2xl font-bold mb-4 text-primary">Evolu√ß√£o do Lucro</h2>
                    <div class="h-80 bg-tertiary text-primary rounded-2xl p-4 flex items-center justify-center">
                        <canvas id="profitChart"></canvas>
                    </div>
                    <div class="mt-6">
                        <h3 class="font-bold text-lg mb-2 text-primary">Hist√≥rico Visual por Plano</h3>
                        <div id="plan-history-visual" class="space-y-4">
                            ${Config.plans.map(plan => {
                                const planProfits = State.state.history.filter(item => item.type === 'profit' && item.description.includes(plan.name));
                                const totalProfitForPlan = planProfits.reduce((sum, item) => sum + item.amount, 0);
                                return `
                                    <div class="bg-tertiary text-primary p-3 rounded-lg">
                                        <p class="font-semibold">${plan.name}: <span class="text-green-500">${totalProfitForPlan.toFixed(2)} MZN</span></p>
                                        <div class="w-full bg-border-color rounded-full h-2 mt-1">
                                            <div class="bg-accent h-2 rounded-full progress-bar-fill" style="width: ${Math.min(100, (totalProfitForPlan / (plan.price * plan.profitMultiplier)) * 100)}%"></div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                            ${Config.plans.length === 0 ? '<p class="text-secondary text-center p-4">Nenhum hist√≥rico de plano dispon√≠vel.</p>' : ''}
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="font-bold text-lg mb-2 text-primary">Simula√ß√£o de Carteira de Investimentos</h3>
                        <div class="bg-tertiary text-primary p-4 rounded-lg">
                            <p class="text-secondary text-sm">Sua carteira simulada: A√ß√µes (70%), T√≠tulos (20%), Criptomoedas (10%).</p>
                            <p class="text-secondary text-sm mt-2">Retorno anual simulado: +12%</p>
                            <button class="mt-4 bg-accent text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 transition" data-tooltip="Ver detalhes da carteira simulada">Ver Carteira</button>
                        </div>
                    </div>
                `);
                const ctx = UI.qs('#profitChart').getContext('2d');
                const history = [...State.state.history].reverse(); // Copia e inverte para ordem cronol√≥gica
                
                let cumulativeBalance = 0;
                const dataPoints = [];
                // Calcula o saldo cumulativo para os dados do gr√°fico
                history.forEach(item => {
                    // Inclui apenas entradas de lucro/perda, n√£o ativa√ß√µes de plano
                    if (item.type !== 'plan') { 
                        cumulativeBalance += item.amount;
                        dataPoints.push({ x: new Date(item.date), y: cumulativeBalance });
                    }
                });
                
                // Adiciona um ponto inicial zero se n√£o houver dados para um gr√°fico mais limpo
                if (dataPoints.length === 0) {
                    dataPoints.push({ x: new Date(), y: 0 });
                }

                // Destr√≥i a inst√¢ncia anterior do gr√°fico se existir
                if (this.chartInstance) this.chartInstance.destroy(); 
                this.chartInstance = new Chart(ctx, {
                    type: 'line', // Manter como linha para consist√™ncia, mas pode ser alterado para 'bar'
                    data: { 
                        datasets: [{ 
                            label: 'Evolu√ß√£o do Lucro (MZN)', 
                            data: dataPoints, 
                            borderColor: 'var(--text-accent)', // Cor da linha do gr√°fico
                            backgroundColor: 'rgba(37, 99, 235, 0.1)', // Cor da √°rea preenchida
                            fill: true, 
                            tension: 0.3, // Suaviza as linhas do gr√°fico
                            pointRadius: State.state.settings.performanceMode === 'economic' ? 2 : (State.state.settings.performanceMode === 'hd' ? 4 : 6),
                            pointBackgroundColor: 'var(--text-accent)', // Cor dos pontos
                            pointBorderColor: 'var(--bg-secondary)', // Cor da borda dos pontos
                            pointHoverRadius: State.state.settings.performanceMode === 'economic' ? 4 : (State.state.settings.performanceMode === 'hd' ? 6 : 8)
                        }] 
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        animation: State.state.settings.performanceMode === 'economic' ? false : { duration: 1000 },
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'var(--text-primary)' // Cor do texto da legenda
                                }
                            }
                        },
                        scales: { 
                            x: { 
                                type: 'time', // Tipo de escala para tempo
                                time: { 
                                    unit: 'day', // Unidade de tempo
                                    tooltipFormat: 'dd/MM/yyyy HH:mm' // Formato do tooltip
                                },
                                title: {
                                    display: true,
                                    text: 'Data',
                                    color: 'var(--text-secondary)'
                                },
                                ticks: {
                                    color: 'var(--text-secondary)' // Cor dos r√≥tulos do eixo X
                                },
                                grid: {
                                    color: 'var(--border-color)' // Cor das linhas de grade do eixo X
                                }
                            }, 
                            y: { 
                                beginAtZero: true, // Come√ßa o eixo Y em zero
                                title: {
                                    display: true,
                                    text: 'Saldo (MZN)',
                                    color: 'var(--text-secondary)'
                                },
                                ticks: {
                                    color: 'var(--text-secondary)' // Cor dos r√≥tulos do eixo Y
                                },
                                grid: {
                                    color: 'var(--border-color)' // Cor das linhas de grade do eixo Y
                                }
                            } 
                        } 
                    }
                });
            },
            
            // Renderiza a tela do IA Hub (chat com a IA).
            renderAIHub(container) {
                UI.render(container, `
                    <h2 class="text-2xl font-bold mb-4 text-primary">IA Hub</h2>
                    <div class="bg-tertiary text-primary rounded-2xl p-4 flex flex-col h-full max-h-[70vh]">
                        <div id="ai-chat-messages" class="flex-grow space-y-4 overflow-y-auto pr-2 pb-4 flex flex-col">
                            <!-- Mensagens do hist√≥rico de chat da IA -->
                            ${IA.chatHistory.map(msg => `
                                <div class="p-3 rounded-lg shadow-sm fade-in ${msg.role === 'user' ? 'bg-accent text-white self-end ml-auto max-w-[80%]' : 'bg-accent/10 text-accent self-start mr-auto max-w-[80%]'} ${msg.role === 'ai' && State.state.settings.aiHumor ? 'pulse-once' : ''}">
                                    ${msg.text}
                                </div>
                            `).join('')}
                            ${IA.chatHistory.length === 0 ? `<div class="p-3 rounded-lg bg-accent/10 text-accent max-w-xs self-start mr-auto fade-in">${IA.profiles[State.state.settings.aiProfile].greeting}</div>` : ''}
                        </div>
                        <div class="flex-shrink-0 mt-4">
                            <div class="flex">
                                <input type="text" id="ai-input" class="w-full p-3 bg-secondary text-primary border border-border-color rounded-l-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Pergunte √† IA..." data-tooltip="Digite sua pergunta para a IA">
                                <button id="ai-send" class="bg-accent text-white px-4 rounded-r-lg font-bold hover:opacity-90 transition" data-tooltip="Enviar pergunta">Enviar</button>
                            </div>
                            <div class="grid grid-cols-2 gap-2 mt-2">
                                <button id="ai-business-idea" class="bg-purple-500 text-white font-bold py-2 rounded-lg hover:bg-purple-600 transition" data-tooltip="Gerar uma ideia de neg√≥cio com a IA">‚ú® Gerar Ideia de Neg√≥cio</button>
                                <button id="ai-market-analysis" class="bg-teal-500 text-white font-bold py-2 rounded-lg hover:bg-teal-600 transition" data-tooltip="Obter an√°lise de mercado e conselhos de investimento">‚ú® An√°lise de Mercado</button>
                            </div>
                            <div class="grid grid-cols-2 gap-2 mt-2">
                                <button id="ai-reformulate" class="bg-blue-500 text-white font-bold py-2 rounded-lg hover:bg-blue-600 transition" data-tooltip="Pedir para a IA reformular a √∫ltima resposta">‚ú® Reformular Resposta</button>
                                <button id="ai-voice-input" class="bg-green-500 text-white font-bold py-2 rounded-lg hover:bg-green-600 transition" data-tooltip="Comando de voz direto (simulado)">‚ú® Comando Voz</button>
                            </div>
                            <div class="grid grid-cols-2 gap-2 mt-2">
                                <button id="ai-motivational-story" class="bg-yellow-500 text-white font-bold py-2 rounded-lg hover:bg-yellow-600 transition" data-tooltip="Pe√ßa √† IA para contar uma hist√≥ria motivacional">‚ú® Contar Hist√≥ria Motivacional</button>
                                <button id="ai-analyze-gains" class="bg-pink-500 text-white font-bold py-2 rounded-lg hover:bg-pink-600 transition" data-tooltip="Pe√ßa √† IA para analisar seus padr√µes de ganhos">‚ú® Analisar Padr√µes de Ganhos</button>
                            </div>
                            <button id="ai-photo-input" class="w-full mt-2 bg-purple-500 text-white font-bold py-2 rounded-lg hover:bg-purple-600 transition" data-tooltip="Simular reconhecimento de exerc√≠cio por foto (IA Escolar)">‚ú® IA Escolar (Foto)</button>
                            <button id="ai-pdf-marketing" class="w-full mt-2 bg-orange-500 text-white font-bold py-2 rounded-lg hover:bg-orange-600 transition" data-tooltip="Simular cria√ß√£o de PDF de Marketing Digital">‚ú® PDF Marketing</button>
                        </div>
                    </div>
                `);

                const chatMessagesContainer = UI.qs('#ai-chat-messages');
                const aiInput = UI.qs('#ai-input');

                // Fun√ß√£o para adicionar mensagens ao chat
                const appendMessage = (text, sender) => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `p-3 rounded-lg shadow-sm fade-in ${sender === 'user' ? 'bg-accent text-white self-end ml-auto max-w-[80%]' : 'bg-accent/10 text-accent self-start mr-auto max-w-[80%]'} ${sender === 'ai' && State.state.settings.aiHumor ? 'pulse-once' : ''}`;
                    messageDiv.textContent = text;
                    chatMessagesContainer.appendChild(messageDiv);
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Rola para o final
                };

                // Fun√ß√£o para lidar com o envio de mensagens para a IA
                const sendAction = async (predefinedQuery = null) => {
                    const userQuery = predefinedQuery || aiInput.value.trim();
                    if (!userQuery) return;

                    appendMessage(userQuery, 'user'); // Adiciona a mensagem do usu√°rio ao chat
                    aiInput.value = ''; // Limpa o campo de entrada

                    // Adiciona um indicador de "IA est√° a pensar..."
                    const typingIndicator = document.createElement('div');
                    typingIndicator.className = 'p-3 rounded-lg bg-accent/10 text-accent max-w-xs typing-effect self-start mr-auto';
                    typingIndicator.textContent = 'IA est√° a pensar...';
                    chatMessagesContainer.appendChild(typingIndicator);
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

                    const aiResponse = await IA.analyze(userQuery); // Obt√©m a resposta da IA
                    typingIndicator.remove(); // Remove o indicador de digita√ß√£o
                    appendMessage(aiResponse, 'ai'); // Adiciona a resposta da IA ao chat
                    IA.speak(aiResponse); // Faz a IA falar a resposta
                    
                    // Simula√ß√£o de aprendizado com cliques (qualquer intera√ß√£o √© um clique)
                    State.state.gamification.xp += 5; // Ganha XP por interagir
                    if (State.state.gamification.xp >= State.state.gamification.level * 100) {
                        State.state.gamification.level++;
                        State.state.gamification.xp = 0;
                        UI.showToast(`Parab√©ns! Voc√™ subiu para o N√≠vel ${State.state.gamification.level}! üéâ`, "achievement");
                    }
                };

                UI.qs('#ai-send').addEventListener('click', () => sendAction());
                aiInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendAction(); });
                
                // Listener para o bot√£o "Reformular Resposta"
                UI.qs('#ai-reformulate').addEventListener('click', async () => {
                    const lastUserMessage = IA.chatHistory.findLast(msg => msg.role === 'user')?.text;
                    if (lastUserMessage) {
                        appendMessage("Reformular resposta sobre: " + lastUserMessage, 'user');
                        const typingIndicator = document.createElement('div');
                        typingIndicator.className = 'p-3 rounded-lg bg-accent/10 text-accent max-w-xs typing-effect self-start mr-auto';
                        typingIndicator.textContent = 'IA est√° a reformular...';
                        chatMessagesContainer.appendChild(typingIndicator);
                        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

                        await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));
                        const reformulatedResponse = await IA.analyze(`Reformule a resposta sobre: ${lastUserMessage}`);
                        typingIndicator.remove();
                        appendMessage(reformulatedResponse, 'ai');
                        IA.speak(reformulatedResponse);
                    } else {
                        UI.showToast("Nenhuma mensagem anterior para reformular.", "info");
                    }
                });

                // New LLM-powered features
                UI.qs('#ai-business-idea').addEventListener('click', () => {
                    sendAction("Gerar uma ideia de neg√≥cio para mim.");
                });
                UI.qs('#ai-market-analysis').addEventListener('click', () => {
                    sendAction("Fazer uma an√°lise de mercado e dar conselhos de investimento.");
                });

                // Listener for "Motivational Story" button
                UI.qs('#ai-motivational-story').addEventListener('click', () => {
                    sendAction("Conte-me uma hist√≥ria motivacional.");
                });

                // Listener for "Analyze Gains Patterns" button
                UI.qs('#ai-analyze-gains').addEventListener('click', () => {
                    const profitHistory = State.state.history.filter(item => item.type === 'profit').map(item => item.amount);
                    if (profitHistory.length > 0) {
                        const query = `Analise meus padr√µes de ganhos. Meu hist√≥rico de lucros √©: ${profitHistory.join(', ')}. D√™ recomenda√ß√µes.`;
                        sendAction(query);
                    } else {
                        UI.showToast("Nenhum lucro registrado para an√°lise ainda.", "info");
                        IA.typeFloatingBubble("Parece que voc√™ ainda n√£o tem lucros registrados. Ative um plano para come√ßarmos a analisar seus ganhos!");
                    }
                });

                // Listener para o bot√£o "Comando Voz" (agora com modal e LLM)
                UI.qs('#ai-voice-input').addEventListener('click', () => {
                    UI.showModal('Comando de Voz',
                        `<p class="text-center text-secondary mb-4">Digite seu comando de voz para a IA analisar:</p>
                         <input type="text" id="voice-command-input" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Ex: 'Qual o melhor plano?' ou 'Me conte uma piada.'">`,
                        `<button id="send-voice-command-btn" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition">Enviar Comando</button>`
                    );
                    UI.qs('#send-voice-command-btn').addEventListener('click', () => {
                        const command = UI.qs('#voice-command-input').value.trim();
                        if (command) {
                            UI.hideModal();
                            sendAction(`Comando de voz: ${command}`);
                        } else {
                            UI.showToast("Por favor, digite um comando de voz.", "error");
                        }
                    });
                });

                // Listener para o bot√£o "IA Escolar (Foto)" (agora com modal e LLM para descri√ß√£o)
                UI.qs('#ai-photo-input').addEventListener('click', () => {
                    UI.showModal('IA Escolar (An√°lise de Imagem)',
                        `<p class="text-center text-secondary mb-4">Descreva o exerc√≠cio ou problema na imagem para a IA analisar:</p>
                         <textarea id="image-description-input" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent h-24" placeholder="Ex: 'A imagem mostra um problema de matem√°tica sobre c√°lculo de juros simples.'"></textarea>`,
                        `<button id="analyze-image-btn" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition">Analisar Imagem</button>`
                    );
                    UI.qs('#analyze-image-btn').addEventListener('click', () => {
                        const description = UI.qs('#image-description-input').value.trim();
                        if (description) {
                            UI.hideModal();
                            sendAction(`Analisar imagem escolar: ${description}`);
                        } else {
                            UI.showToast("Por favor, descreva a imagem para a IA.", "error");
                        }
                    });
                });

                // Listener para o bot√£o "PDF Marketing" (agora com modal e LLM para conte√∫do)
                UI.qs('#ai-pdf-marketing').addEventListener('click', () => {
                    UI.showModal('Gerar Conte√∫do para PDF de Marketing',
                        `<p class="text-center text-secondary mb-4">Qual o t√≥pico principal do seu PDF de Marketing Digital?</p>
                         <input type="text" id="marketing-topic-input" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" placeholder="Ex: 'Estrat√©gias de SEO para Pequenas Empresas'">`,
                        `<button id="generate-marketing-content-btn" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition">Gerar Conte√∫do</button>`
                    );
                    UI.qs('#generate-marketing-content-btn').addEventListener('click', () => {
                        const topic = UI.qs('#marketing-topic-input').value.trim();
                        if (topic) {
                            UI.hideModal();
                            sendAction(`Gerar conte√∫do de marketing para: ${topic}`);
                        } else {
                            UI.showToast("Por favor, insira um t√≥pico para o PDF.", "error");
                        }
                    });
                });
            },

            // Renderiza a tela de Configura√ß√µes.
            renderSettings(container) {
                const settings = State.state.settings;
                UI.render(container, `
                    <h2 class="text-2xl font-bold mb-6 text-primary">Configura√ß√µes</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="theme-setting" class="block text-sm font-medium mb-1 text-primary">Tema Visual</label>
                            <select id="theme-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Escolha o tema da aplica√ß√£o">
                                <option value="light" ${settings.theme === 'light' ? 'selected' : ''}>Padr√£o Claro</option>
                                <option value="dark" ${settings.theme === 'dark' ? 'selected' : ''}>Padr√£o Escuro</option>
                                <option value="iphone" ${settings.theme === 'iphone' ? 'selected' : ''}>Tema iPhone</option>
                                <option value="android" ${settings.theme === 'android' ? 'selected' : ''}>Tema Android</option>
                                <option value="windows" ${settings.theme === 'windows' ? 'selected' : ''}>Tema Windows</option>
                                <option value="turbo-dark" ${settings.theme === 'turbo-dark' ? 'selected' : ''}>Tema Turbo Escuro (Hacker)</option>
                                <option value="cyberpunk" ${settings.theme === 'cyberpunk' ? 'selected' : ''}>Cyberpunk (Ultra HD)</option>
                                <option value="oceanic" ${settings.theme === 'oceanic' ? 'selected' : ''}>Oce√¢nico (Ultra HD)</option>
                                <option value="minimalist-pro" ${settings.theme === 'minimalist-pro' ? 'selected' : ''}>Minimalista Pro (Ultra HD)</option>
                                <option value="galaxy" ${settings.theme === 'galaxy' ? 'selected' : ''}>Galaxy (Ultra HD)</option> <!-- NEW -->
                                <option value="sunset" ${settings.theme === 'sunset' ? 'selected' : ''}>P√¥r do Sol (Ultra HD)</option> <!-- NEW -->
                            </select>
                        </div>
                        <div>
                            <label for="high-contrast-setting" class="block text-sm font-medium mb-1 text-primary">Modo Alto Contraste</label>
                            <select id="high-contrast-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Melhora a visibilidade para acessibilidade">
                                <option value="false" ${!settings.highContrast ? 'selected' : ''}>Desativado</option>
                                <option value="true" ${settings.highContrast ? 'selected' : ''}>Ativado</option>
                            </select>
                        </div>
                        <div>
                            <label for="font-size-setting" class="block text-sm font-medium mb-1 text-primary">Tamanho da Fonte (Modo Leitura)</label>
                            <select id="font-size-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Ajusta o tamanho da fonte para melhor leitura">
                                <option value="small" ${settings.fontSize === 'small' ? 'selected' : ''}>Pequeno</option>
                                <option value="normal" ${settings.fontSize === 'normal' ? 'selected' : ''}>Normal</option>
                                <option value="large" ${settings.fontSize === 'large' ? 'selected' : ''}>Grande</option>
                            </select>
                        </div>
                        <div>
                            <label for="performance-mode-setting" class="block text-sm font-medium mb-1 text-primary">Modo Gr√°fico (Desempenho)</label>
                            <select id="performance-mode-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Ajusta anima√ß√µes e efeitos visuais para melhor desempenho">
                                <option value="economic" ${settings.performanceMode === 'economic' ? 'selected' : ''}>Econ√¥mico (M√≠nimo)</option>
                                <option value="hd" ${settings.performanceMode === 'hd' ? 'selected' : ''}>HD (Suave)</option>
                                <option value="ultra" ${settings.performanceMode === 'ultra' ? 'selected' : ''}>Ultra (Completo)</option>
                                <option value="extreme" ${settings.performanceMode === 'extreme' ? 'selected' : ''}>4K/Ultra Qualidade (M√°ximo)</option> <!-- Updated text -->
                            </select>
                        </div>
                        <div>
                            <label for="text-style-setting" class="block text-sm font-medium mb-1 text-primary">Estilo de Texto</label>
                            <select id="text-style-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Escolha o estilo visual do texto">
                                <option value="default" ${settings.textStyle === 'default' ? 'selected' : ''}>Padr√£o</option>
                                <option value="white" ${settings.textStyle === 'white' ? 'selected' : ''}>Branco</option> <!-- NEW -->
                                <option value="black" ${settings.textStyle === 'black' ? 'selected' : ''}>Preto</option> <!-- NEW -->
                                <option value="green" ${settings.textStyle === 'green' ? 'selected' : ''}>Verde</option> <!-- NEW -->
                                <option value="red" ${settings.textStyle === 'red' ? 'selected' : ''}>Vermelho</option> <!-- NEW -->
                                <option value="golden" ${settings.textStyle === 'golden' ? 'selected' : ''}>Negrito Dourado</option>
                                <option value="neon-glow" ${settings.textStyle === 'neon-glow' ? 'selected' : ''}>Verde Neon</option>
                                <option value="pink-glow" ${settings.textStyle === 'pink-glow' ? 'selected' : ''}>Rosa Luminoso</option>
                            </select>
                        </div>
                        <div>
                            <label for="notification-style-setting" class="block text-sm font-medium mb-1 text-primary">Estilo de Notifica√ß√£o</label>
                            <select id="notification-style-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Escolha o estilo visual das notifica√ß√µes">
                                <option value="suave" ${settings.notificationStyle === 'suave' ? 'selected' : ''}>Suave</option> <!-- Updated -->
                                <option value="hd" ${settings.notificationStyle === 'hd' ? 'selected' : ''}>HD</option> <!-- Updated -->
                                <option value="alerta" ${settings.notificationStyle === 'alerta' ? 'selected' : ''}>Alerta</option> <!-- NEW -->
                                <option value="minimalista" ${settings.notificationStyle === 'minimalista' ? 'selected' : ''}>Minimalista</option> <!-- NEW -->
                                <option value="futurista" ${settings.notificationStyle === 'futurista' ? 'selected' : ''}>Futurista</option> <!-- NEW -->
                                <option value="neon" ${settings.notificationStyle === 'neon' ? 'selected' : ''}>Neon</option> <!-- NEW -->
                            </select>
                        </div>
                        <div>
                            <label for="button-color-setting" class="block text-sm font-medium mb-1 text-primary">Cor dos Bot√µes</label>
                            <select id="button-color-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Escolha o esquema de cores para os bot√µes">
                                <option value="default" ${settings.buttonColor === 'default' ? 'selected' : ''}>Padr√£o (do Tema)</option>
                                <option value="blue" ${settings.buttonColor === 'blue' ? 'selected' : ''}>Azul</option>
                                <option value="green" ${settings.buttonColor === 'green' ? 'selected' : ''}>Verde</option>
                                <option value="purple" ${settings.buttonColor === 'purple' ? 'selected' : ''}>Roxo</option>
                                <option value="orange" ${settings.buttonColor === 'orange' ? 'selected' : ''}>Laranja</option>
                            </select>
                        </div>
                        <div>
                            <label for="device-layout-setting" class="block text-sm font-medium mb-1 text-primary">Modo de Tela (Layout)</label>
                            <select id="device-layout-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Otimiza o layout para diferentes dispositivos">
                                <option value="default" ${settings.deviceLayoutMode === 'default' ? 'selected' : ''}>Padr√£o (Responsivo)</option>
                                <option value="android" ${settings.deviceLayoutMode === 'android' ? 'selected' : ''}>Android</option>
                                <option value="ios" ${settings.deviceLayoutMode === 'ios' ? 'selected' : ''}>iOS</option>
                                <option value="desktop" ${settings.deviceLayoutMode === 'desktop' ? 'selected' : ''}>Desktop</option>
                            </select>
                        </div>
                        <div>
                            <label for="ai-profile-setting" class="block text-sm font-medium mb-1 text-primary">Perfil da IA</label>
                            <select id="ai-profile-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Escolha a personalidade e voz da sua IA">
                                <option value="kylian" ${settings.aiProfile === 'kylian' ? 'selected' : ''}>üßî Kylian IA (Jovem, Motivador)</option>
                                <option value="mentor" ${settings.aiProfile === 'mentor' ? 'selected' : ''}>üë®‚Äçüè´ Mentor (T√©cnico, Formal)</option>
                                <option value="mulher_profissional" ${settings.aiProfile === 'mulher_profissional' ? 'selected' : ''}>üë© Mulher Profissional (Atenciosa)</option>
                                <option value="mulher_amigavel" ${settings.aiProfile === 'mulher_amigavel' ? 'selected' : ''}>üëß Mulher Amig√°vel (Divertida)</option>
                                <option value="mulher_zangada" ${settings.aiProfile === 'mulher_zangada' ? 'selected' : ''}>üò° Mulher Zangada (Sarc√°stica)</option>
                                <option value="homem_zangado" ${settings.aiProfile === 'homem_zangado' ? 'selected' : ''}>üò† Homem Zangado (C√¥mico)</option>
                            </select>
                        </div>
                        <div>
                            <label for="chat-theme-setting" class="block text-sm font-medium mb-1 text-primary">Tema do Chat da IA</label>
                            <select id="chat-theme-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Define o estilo de conversa da IA no chat">
                                <option value="empreendedor" ${settings.chatTheme === 'empreendedor' ? 'selected' : ''}>Empreendedor</option>
                                <option value="gamer" ${settings.chatTheme === 'gamer' ? 'selected' : ''}>Gamer</option>
                                <option value="escolar" ${settings.chatTheme === 'escolar' ? 'selected' : ''}>Escolar</option>
                                <option value="casual" ${settings.chatTheme === 'casual' ? 'selected' : ''}>Casual</option>
                            </select>
                        </div>
                        <div>
                            <label for="voice-setting" class="block text-sm font-medium mb-1 text-primary">IA por Voz</label>
                            <select id="voice-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Ativar ou desativar a voz da IA">
                                <option value="false" ${!settings.aiVoice ? 'selected' : ''}>Desativada</option>
                                <option value="true" ${settings.aiVoice ? 'selected' : ''}>Ativada</option>
                            </select>
                        </div>
                        <div>
                            <label for="whisper-setting" class="block text-sm font-medium mb-1 text-primary">Modo Sussurrar (Voz Baixa)</label>
                            <select id="whisper-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Ativar modo de voz mais suave para a IA">
                                <option value="false" ${!settings.aiWhisper ? 'selected' : ''}>Desativado</option>
                                <option value="true" ${settings.aiWhisper ? 'selected' : ''}>Ativado</option>
                            </select>
                        </div>
                        <div>
                            <label for="sotaque-setting" class="block text-sm font-medium mb-1 text-primary">Sotaque da IA</label>
                            <select id="sotaque-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Simula diferentes sotaques para a voz da IA">
                                <option value="pt-BR" ${settings.currentSotaque === 'pt-BR' ? 'selected' : ''}>Portugu√™s (Brasil)</option>
                                <option value="pt-PT" ${settings.currentSotaque === 'pt-PT' ? 'selected' : ''}>Portugu√™s (Portugal)</option>
                                <option value="en-US" ${settings.currentSotaque === 'en-US' ? 'selected' : ''}>Ingl√™s (EUA)</option>
                                <option value="fr-FR" ${settings.currentSotaque === 'fr-FR' ? 'selected' : ''}>Franc√™s</option>
                            </select>
                        </div>
                        <div>
                            <label for="humor-setting" class="block text-sm font-medium mb-1 text-primary">Humor da IA</label>
                            <select id="humor-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Ativar ou desativar o humor da IA">
                                <option value="false" ${!settings.aiHumor ? 'selected' : ''}>Desativado</option>
                                <option value="true" ${settings.aiHumor ? 'selected' : ''}>Ativado</option>
                            </select>
                        </div>
                        <div>
                            <label for="silent-mode-setting" class="block text-sm font-medium mb-1 text-primary">Modo Sil√™ncio Total</label>
                            <select id="silent-mode-setting" class="w-full p-3 bg-tertiary text-primary border border-border-color rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" data-tooltip="Desativa todos os sons e voz da IA">
                                <option value="false" ${!settings.silentMode ? 'selected' : ''}>Desativado</option>
                                <option value="true" ${settings.silentMode ? 'selected' : ''}>Ativado</option>
                            </select>
                        </div>
                        <div class="border-t border-border-color pt-6">
                            <h3 class="text-lg font-semibold text-red-500">Zona de Perigo</h3>
                            <p class="text-secondary text-sm mt-2 mb-4">Cuidado: Estas a√ß√µes s√£o irrevers√≠veis.</p>
                            <button id="logout-btn" class="w-full bg-red-500 text-white font-bold py-3 rounded-lg hover:bg-red-600 transition mb-2" data-tooltip="Sair da sua conta">Sair da Conta</button>
                            <button id="reset-account-btn" class="w-full bg-red-700 text-white font-bold py-3 rounded-lg hover:bg-red-800 transition" data-tooltip="Deletar permanentemente sua conta e dados">Resetar Conta</button>
                            <button id="qr-code-btn" class="w-full mt-2 bg-blue-500 text-white font-bold py-3 rounded-lg hover:bg-blue-600 transition" data-tooltip="Gerar QR Code para abrir no PC">Gerar QR Code</button>
                            <button id="share-profit-btn" class="w-full mt-2 bg-green-500 text-white font-bold py-3 rounded-lg hover:bg-green-600 transition" data-tooltip="Compartilhar seu lucro no WhatsApp">Compartilhar Lucro</button>
                            <button id="export-data-btn" class="w-full mt-2 bg-purple-500 text-white font-bold py-3 rounded-lg hover:bg-purple-600 transition" data-tooltip="Exportar seus dados da conta como JSON">Exportar Dados (JSON)</button>
                        </div>
                    </div>
                `);
                // Adiciona listeners para os controles de configura√ß√£o
                UI.qs('#theme-setting').addEventListener('change', (e) => {
                    State.state.settings.theme = e.target.value;
                    UI.applyTheme(State.state.settings.theme);
                    UI.showToast(`Tema alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                });
                UI.qs('#high-contrast-setting').addEventListener('change', (e) => {
                    State.state.settings.highContrast = e.target.value === 'true';
                    UI.applyHighContrast(State.state.settings.highContrast);
                    UI.showToast(`Modo Alto Contraste ${State.state.settings.highContrast ? 'ativado' : 'desativado'}!`);
                });
                UI.qs('#font-size-setting').addEventListener('change', (e) => {
                    State.state.settings.fontSize = e.target.value;
                    document.documentElement.style.fontSize = e.target.value === 'large' ? '1.1em' : (e.target.value === 'small' ? '0.9em' : '1em');
                    UI.showToast(`Tamanho da fonte alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                });
                UI.qs('#performance-mode-setting').addEventListener('change', (e) => {
                    State.state.settings.performanceMode = e.target.value;
                    UI.applyPerformanceMode(State.state.settings.performanceMode);
                    UI.showToast(`Modo Gr√°fico alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                    // For√ßa a atualiza√ß√£o do gr√°fico para aplicar as anima√ß√µes
                    if (window.location.hash === '#chart') App.renderChart(UI.qs('#app-content'));
                });
                UI.qs('#text-style-setting').addEventListener('change', (e) => {
                    State.state.settings.textStyle = e.target.value;
                    UI.applyTextStyle(State.state.settings.textStyle);
                    UI.showToast(`Estilo de texto alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                });
                UI.qs('#notification-style-setting').addEventListener('change', (e) => {
                    State.state.settings.notificationStyle = e.target.value;
                    UI.showToast(`Estilo de notifica√ß√£o alterado para ${e.target.options[e.target.selectedIndex].text}!`, 'info'); // Test the new style
                });
                UI.qs('#button-color-setting').addEventListener('change', (e) => {
                    State.state.settings.buttonColor = e.target.value;
                    UI.applyButtonColors(State.state.settings.buttonColor);
                    UI.showToast(`Cor dos bot√µes alterada para ${e.target.options[e.target.selectedIndex].text}!`);
                });
                UI.qs('#device-layout-setting').addEventListener('change', (e) => {
                    State.state.settings.deviceLayoutMode = e.target.value;
                    UI.applyDeviceLayoutMode(State.state.settings.deviceLayoutMode);
                    UI.showToast(`Modo de tela alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                });
                UI.qs('#ai-profile-setting').addEventListener('change', (e) => {
                    State.state.settings.aiProfile = e.target.value;
                    UI.showToast(`Perfil da IA alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                    IA.speak(IA.profiles[State.state.settings.aiProfile].greeting); // Testa o novo perfil
                });
                UI.qs('#chat-theme-setting').addEventListener('change', (e) => {
                    State.state.settings.chatTheme = e.target.value;
                    UI.showToast(`Tema do Chat da IA alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                });
                UI.qs('#voice-setting').addEventListener('change', (e) => {
                    State.state.settings.aiVoice = e.target.value === 'true';
                    UI.showToast(`Voz da IA ${State.state.settings.aiVoice ? 'ativada' : 'desativada'}!`);
                    if (State.state.settings.aiVoice) IA.speak("Voz ativada.");
                });
                UI.qs('#whisper-setting').addEventListener('change', (e) => {
                    State.state.settings.aiWhisper = e.target.value === 'true';
                    UI.showToast(`Modo Sussurrar da IA ${State.state.settings.aiWhisper ? 'ativado' : 'desativado'}!`);
                    if (State.state.settings.aiWhisper) IA.speak("Modo sussurrar ativado.");
                });
                UI.qs('#sotaque-setting').addEventListener('change', (e) => {
                    State.state.settings.currentSotaque = e.target.value;
                    UI.showToast(`Sotaque da IA alterado para ${e.target.options[e.target.selectedIndex].text}!`);
                    IA.speak("Ol√°! Como posso ajudar?"); // Testa o novo sotaque
                });
                UI.qs('#humor-setting').addEventListener('change', (e) => {
                    State.state.settings.aiHumor = e.target.value === 'true';
                    UI.showToast(`Humor da IA ${e.target.value === 'true' ? 'ativado' : 'desativado'}!`);
                    if (State.state.settings.aiHumor) IA.speak("Prepare-se para algumas risadas! üòÇ");
                });
                 UI.qs('#silent-mode-setting').addEventListener('change', (e) => {
                    State.state.settings.silentMode = e.target.value === 'true';
                    UI.showToast(`Modo Sil√™ncio Total ${State.state.settings.silentMode ? 'ativado' : 'desativado'}!`);
                    if (!State.state.settings.silentMode) IA.speak("Modo sil√™ncio desativado.");
                });

                UI.qs('#logout-btn').addEventListener('click', () => this.logout());
                UI.qs('#reset-account-btn').addEventListener('click', () => this.confirmResetAccount());
                UI.qs('#qr-code-btn').addEventListener('click', () => this.generateQRCode());
                UI.qs('#share-profit-btn').addEventListener('click', () => this.shareProfit());
                UI.qs('#export-data-btn').addEventListener('click', () => this.exportData());
            },

            // Realiza o logout do usu√°rio.
            logout() {
                localStorage.removeItem('iaTurboSession'); // Remove a sess√£o ativa
                window.location.reload(); // Recarrega a p√°gina para voltar √† tela de login
            },

            // Exibe um modal de confirma√ß√£o para resetar a conta.
            confirmResetAccount() {
                UI.showModal('Confirmar Reset',
                    `<p class="text-center text-secondary mb-4">Tem certeza que deseja resetar sua conta? Todos os dados ser√£o perdidos e esta a√ß√£o √© irrevers√≠vel.</p>
                     <p class="text-center text-red-500 text-sm">Para reativar a conta, ser√° necess√°rio um novo dep√≥sito m√≠nimo (simulado).</p>`,
                    `<button id="confirm-reset-btn" class="w-full bg-red-600 text-white font-bold py-3 rounded-lg mb-2 hover:bg-red-700 transition" data-tooltip="Confirmar reset da conta">Sim, Resetar</button>
                     <button id="cancel-reset-btn" class="w-full bg-tertiary text-secondary font-bold py-3 rounded-lg hover:bg-border-color transition" data-tooltip="Cancelar reset da conta">Cancelar</button>`
                );
                UI.qs('#confirm-reset-btn').addEventListener('click', () => this.resetAccount());
                UI.qs('#cancel-reset-btn').addEventListener('click', UI.hideModal);
            },

            // Reseta a conta do usu√°rio (deleta todos os dados).
            resetAccount() {
                State.reset(); // Deleta os dados da conta
                UI.hideModal();
                UI.showToast("Conta resetada com sucesso!", "info");
                setTimeout(() => window.location.reload(), 1500); // Recarrega ap√≥s um pequeno atraso
            },

            // Simula a gera√ß√£o de QR Code
            generateQRCode() {
                const qrData = `ia-turbo-app://user/${State.state.userId}`; // Exemplo de URL para o QR Code
                UI.showModal('QR Code para PC',
                    `<p class="text-center text-secondary mb-4">Escaneie este QR Code com seu PC para abrir o IA Turbo.</p>
                     <div class="flex justify-center p-4 bg-white rounded-lg">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(qrData)}" alt="QR Code" class="w-32 h-32">
                     </div>`,
                    `<button id="qr-code-close-btn" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:opacity-90 transition">Fechar</button>`
                );
                UI.qs('#qr-code-close-btn').addEventListener('click', UI.hideModal);
            },

            // Simula o compartilhamento de lucro no WhatsApp/Redes Sociais
            shareProfit() {
                const profitToday = State.state.history.filter(i => i.type === 'profit' && new Date(i.date).toDateString() === new Date().toDateString()).reduce((sum, i) => sum + i.amount, 0).toFixed(2);
                const message = `üöÄ Acabei de lucrar ${profitToday} MZN com o IA Turbo hoje! Junte-se a mim e transforme suas ideias em lucro! #IATurbo #Empreendedorismo`;
                
                // Tenta compartilhar via Web Share API (se dispon√≠vel)
                if (navigator.share) {
                    navigator.share({
                        title: 'IA Turbo - Meu Lucro!',
                        text: message,
                        url: window.location.href // URL da aplica√ß√£o
                    }).then(() => UI.showToast('Lucro compartilhado com sucesso!', 'success'))
                      .catch((error) => console.error('Erro ao compartilhar:', error));
                } else {
                    // Fallback para WhatsApp Web/App
                    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    window.open(whatsappUrl, '_blank');
                    UI.showToast('Mensagem pronta para compartilhar no WhatsApp!', 'info');
                }
            },

            // Exporta os dados do usu√°rio como um arquivo JSON
            exportData() {
                const dataStr = JSON.stringify(State.state, null, 2); // Formata com indenta√ß√£o
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ia_turbo_data_${State.state.userId}_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                UI.showToast("Dados exportados com sucesso!", "success");
            }
        };

        // Inicializa a aplica√ß√£o quando o DOM estiver completamente carregado.
        document.addEventListener('DOMContentLoaded', () => App.init());

        // Listener para o estado global (simula atualiza√ß√£o de componentes com diff)
        document.addEventListener('stateUpdated', (e) => {
            console.log(`Estado atualizado: ${e.detail.key}`);
            App.updateDashboard(); // Atualiza o cabe√ßalho
            // Poder√≠amos ter l√≥gica mais granular aqui para atualizar apenas partes espec√≠ficas da UI
            // Ex: if (e.detail.key === 'balance') updateBalanceDisplay();
            // if (e.detail.key === 'activePlan' && window.location.hash === '#dashboard') App.renderDashboard(UI.qs('#app-content'));
        });

        // Simula√ß√£o de auto-reset ap√≥s 24h de inatividade (conceitual)
        // Em um ambiente real, isso seria monitorado no backend ou com Workers.
        setInterval(() => {
            const lastLogin = new Date(State.state.gamification.lastLogin);
            const now = new Date();
            const diffHours = Math.abs(now - lastLogin) / (1000 * 60 * 60);
            if (diffHours >= 24 && State.state.activePlan === null) {
                // UI.showToast("Sua conta foi resetada por inatividade. (Simulado)", "info");
                // State.reset(); // Descomentar para resetar de verdade
                // window.location.reload();
            }
        }, 3600 * 1000); // Verifica a cada hora

        // Simula√ß√£o de "mostrar saldo ao balan√ßar o telefone" (para mobile)
        // Isso requer o DeviceMotionEvent API, que funciona apenas em HTTPS e com permiss√£o do usu√°rio em alguns browsers.
        // Para fins de simula√ß√£o, usaremos um clique longo no saldo.
        const balanceDisplay = UI.qs('#balance-display');
        if (balanceDisplay) {
            let pressTimer;
            balanceDisplay.addEventListener('touchstart', () => {
                pressTimer = setTimeout(() => {
                    // Simula "balan√ßar o telefone"
                    UI.showToast(`Seu saldo atual √©: ${State.state.balance.toFixed(2)} MZN`, 'info');
                    if (navigator.vibrate) navigator.vibrate(200); // Feedback t√°til
                }, 700); // 700ms para ser considerado um "toque longo"
            });
            balanceDisplay.addEventListener('touchend', () => {
                clearTimeout(pressTimer);
            });
            // Para desktop, um clique duplo
            balanceDisplay.addEventListener('dblclick', () => {
                UI.showToast(`Seu saldo atual √©: ${State.state.balance.toFixed(2)} MZN`, 'info');
            });
        }
    </script>
</body>
</html>